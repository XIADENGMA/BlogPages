<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>深入浅出卡尔曼滤波 &#183; MyBlog</title><meta name=title content="深入浅出卡尔曼滤波 &#183; MyBlog"><meta name=description content="My awesome website"><meta name=keywords content="Kalman Filter,Algorithm,Math,"><link rel=canonical href=https://blog.xiadengma.com/posts/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2/><meta name=author content="xiadengma"><link href=https://github.com/xiadengma rel=me><link href=https://xiadengma.com/ rel=me><meta property="og:url" content="https://blog.xiadengma.com/posts/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2/"><meta property="og:site_name" content="MyBlog"><meta property="og:title" content="深入浅出卡尔曼滤波"><meta property="og:description" content="My awesome website"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-09-19T09:49:00+08:00"><meta property="article:modified_time" content="2025-10-19T23:32:35+08:00"><meta property="article:tag" content="Kalman Filter"><meta property="article:tag" content="Algorithm"><meta property="article:tag" content="Math"><meta name=twitter:card content="summary"><meta name=twitter:title content="深入浅出卡尔曼滤波"><meta name=twitter:description content="My awesome website"><link type=text/css rel=stylesheet href=/css/main.bundle.min.cb29af0b9b557171034a26c98fc3772c6565cc7bcac43882f4a3f99e004bb2149ea0632742f50133a3bd8ab1754ab696dd688aa88b59799daae99b48c8a3fad6.css integrity="sha512-yymvC5tVcXEDSibJj8N3LGVlzHvKxDiC9KP5ngBLshSeoGMnQvUBM6O9irF1SraW3WiKqItZeZ2q6ZtIyKP61g=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP+pSqMXxm6JPOUeAg==" data-copy=复制 data-copied=已复制></script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"文章","name":"深入浅出卡尔曼滤波","headline":"深入浅出卡尔曼滤波","inLanguage":"en","url":"https:\/\/blog.xiadengma.com\/posts\/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2\/","author":{"@type":"Person","name":"xiadengma"},"copyrightYear":"2025","dateCreated":"2025-09-19T09:49:00\u002b08:00","datePublished":"2025-09-19T09:49:00\u002b08:00","dateModified":"2025-10-19T23:32:35\u002b08:00","keywords":["Kalman Filter","Algorithm","Math"],"mainEntityOfPage":"true","wordCount":"2287"}]</script><script data-id=umami-script async src=https://analytics.umami.is/script.js data-website-id=678aa4f9-0d3a-485e-88ea-9a4e51d5aa9f></script><script type=text/javascript>document.querySelector('script[data-id="umami-script"]').addEventListener("load",function(){const e=document.head.querySelector('meta[property = "og:type"]').getAttribute("content");let t=document.head.querySelector('meta[property = "og:title"]').getAttribute("content"),n=document.head.querySelector('meta[property = "og:url"]').getAttribute("content");umami.track(e+":"+t,{url:n})})</script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}}</script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js id=MathJax-script></script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
跳过正文</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 min-h-[130px] opacity-65 bg-gradient-to-b from-neutral from-60% dark:from-neutral-800 to-transparent mix-blend-normal z-80"></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0"><div><a href=/ class=flex><span class=sr-only>MyBlog</span>
<img src=/img/logo.png width=90 height=90 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium">MyBlog</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=文章 title=文章><span class=mr-1><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></span><p class="text-base font-medium">文章</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="搜索 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="搜索 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=文章 title=文章><div class=mr-2><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></div><p class="text-bg font-bg">文章</p></a></li></ul></div></div></div></div></div></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src=/img/background_1.svg alt=深入浅出卡尔曼滤波 loading=eager decoding=async fetchpriority=high class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=background-blur data-image-id=background-image data-image-url=/img/background_1.svg></script><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>MyBlog</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>文章</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2/>深入浅出卡尔曼滤波</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">深入浅出卡尔曼滤波</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-09-19T09:49:00+08:00>2025年9月19日</time><span class="px-2 text-primary-500">&#183;</span><time datetime=2025-10-19T23:32:35+08:00>更新:2025年10月19日</time><span class="px-2 text-primary-500">&#183;</span><span>2287 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>11 分钟</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/kalman-filter/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Kalman Filter
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/algorithm/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Algorithm
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/math/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Math</span></span></a></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">目录</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#0-写在开头>0. 写在开头</a></li><li><a href=#原理>原理</a><ul><li><a href=#数学基础与符号约定>数学基础与符号约定</a></li><li><a href=#基本模型>基本模型</a></li><li><a href=#预测步骤推导先验估计值>预测步骤：推导先验估计值</a></li><li><a href=#更新步骤融合测量值修正预测>更新步骤：融合测量值修正预测</a></li><li><a href=#目标函数的建立与转化>目标函数的建立与转化</a></li><li><a href=#卡尔曼增益求解和协方差矩阵化简>卡尔曼增益求解和协方差矩阵化简</a></li><li><a href=#梳理>梳理</a></li><li><a href=#总结>总结</a></li></ul></li><li><a href=#实践>实践</a><ul><li><a href=#调节超参数>调节超参数</a></li><li><a href=#卡尔曼滤波的使用步骤>卡尔曼滤波的使用步骤</a></li><li><a href=#案例分析一一维时序信号的追踪与滤波>案例分析一：一维时序信号的追踪与滤波</a><ul><li><a href=#对应代码和演示视频>对应代码和演示视频</a></li><li><a href=#第一步建立信号的动态模型>第一步：建立信号的动态模型</a></li><li><a href=#第二步构建状态空间方程>第二步：构建状态空间方程</a></li><li><a href=#第三步定义观测模型>第三步：定义观测模型</a></li><li><a href=#模型总结>模型总结</a></li></ul></li><li><a href=#案例分析二二维平面运动轨迹的估计与预测>案例分析二：二维平面运动轨迹的估计与预测</a><ul><li><a href=#对应代码>对应代码</a></li><li><a href=#第一步建立目标的动态模型>第一步：建立目标的动态模型</a></li><li><a href=#第二步定义观测模型>第二步：定义观测模型</a></li><li><a href=#模型总结-1>模型总结</a></li></ul></li><li><a href=#案例分析三三维空间中的刚体姿态跟踪问题>案例分析三：三维空间中的刚体姿态跟踪问题</a><ul><li><a href=#第一步姿态的数学表示>第一步：姿态的数学表示</a></li><li><a href=#第二步非线性的根源姿态运动学>第二步：非线性的根源——姿态运动学</a></li><li><a href=#第三步非线性的观测模型>第三步：非线性的观测模型</a></li><li><a href=#挑战与解决思路>挑战与解决思路</a></li><li><a href=#总结-1>总结</a></li></ul></li></ul></li><li><a href=#结语>结语</a></li><li><a href=#参考资料><em>参考资料</em></a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">目录</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#0-写在开头>0. 写在开头</a></li><li><a href=#原理>原理</a><ul><li><a href=#数学基础与符号约定>数学基础与符号约定</a></li><li><a href=#基本模型>基本模型</a></li><li><a href=#预测步骤推导先验估计值>预测步骤：推导先验估计值</a></li><li><a href=#更新步骤融合测量值修正预测>更新步骤：融合测量值修正预测</a></li><li><a href=#目标函数的建立与转化>目标函数的建立与转化</a></li><li><a href=#卡尔曼增益求解和协方差矩阵化简>卡尔曼增益求解和协方差矩阵化简</a></li><li><a href=#梳理>梳理</a></li><li><a href=#总结>总结</a></li></ul></li><li><a href=#实践>实践</a><ul><li><a href=#调节超参数>调节超参数</a></li><li><a href=#卡尔曼滤波的使用步骤>卡尔曼滤波的使用步骤</a></li><li><a href=#案例分析一一维时序信号的追踪与滤波>案例分析一：一维时序信号的追踪与滤波</a><ul><li><a href=#对应代码和演示视频>对应代码和演示视频</a></li><li><a href=#第一步建立信号的动态模型>第一步：建立信号的动态模型</a></li><li><a href=#第二步构建状态空间方程>第二步：构建状态空间方程</a></li><li><a href=#第三步定义观测模型>第三步：定义观测模型</a></li><li><a href=#模型总结>模型总结</a></li></ul></li><li><a href=#案例分析二二维平面运动轨迹的估计与预测>案例分析二：二维平面运动轨迹的估计与预测</a><ul><li><a href=#对应代码>对应代码</a></li><li><a href=#第一步建立目标的动态模型>第一步：建立目标的动态模型</a></li><li><a href=#第二步定义观测模型>第二步：定义观测模型</a></li><li><a href=#模型总结-1>模型总结</a></li></ul></li><li><a href=#案例分析三三维空间中的刚体姿态跟踪问题>案例分析三：三维空间中的刚体姿态跟踪问题</a><ul><li><a href=#第一步姿态的数学表示>第一步：姿态的数学表示</a></li><li><a href=#第二步非线性的根源姿态运动学>第二步：非线性的根源——姿态运动学</a></li><li><a href=#第三步非线性的观测模型>第三步：非线性的观测模型</a></li><li><a href=#挑战与解决思路>挑战与解决思路</a></li><li><a href=#总结-1>总结</a></li></ul></li></ul></li><li><a href=#结语>结语</a></li><li><a href=#参考资料><em>参考资料</em></a></li></ul></nav></div></details><script>(function(){"use strict";const s=.33,o="#TableOfContents",i=".anchor",a='a[href^="#"]',r="li ul",c="active";let t=!1;function l(e,n){const o=window.scrollY+window.innerHeight*n,i=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],s=new Set(i.map(e=>e.getAttribute("href").substring(1)));if(t)for(let t=0;t<e.length;t++){const n=e[t];if(!s.has(n.id))continue;const o=n.getBoundingClientRect().top+window.scrollY;if(Math.abs(window.scrollY-o)<100)return n.id}for(let t=e.length-1;t>=0;t--){const n=e[t].getBoundingClientRect().top+window.scrollY;if(n<=o&&s.has(e[t].id))return e[t].id}return e.find(e=>s.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=l(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(c,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function n(){const n=document.querySelector(o);if(!n)return;const l=!0,u=[...document.querySelectorAll(i)],d=[...n.querySelectorAll(a)];l&&n.querySelectorAll(r).forEach(e=>e.style.display="none"),d.forEach(e=>{e.addEventListener("click",()=>{t=!0})});const c={toc:n,anchors:u,links:d,scrollOffset:s,collapseInactive:l};window.addEventListener("scroll",()=>e(c),{passive:!0}),window.addEventListener("hashchange",()=>e(c),{passive:!0}),e(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><details class="mt-2 mb-5 overflow-hidden rounded-lg ms-0 ps-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 -ms-5 ps-5 dark:bg-primary-800 dark:text-neutral-100">常见算法深入浅出 -
系列文章</summary><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">§ :
本文</div></details><div class="article-content max-w-prose mb-20"><h2 class="relative group">0. 写在开头<div id=0-写在开头 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#0-%e5%86%99%e5%9c%a8%e5%bc%80%e5%a4%b4 aria-label=锚点>#</a></span></h2><p>点进这篇博客的读者应该都是对卡尔曼滤波有所兴趣的，或者在工作中遇到卡尔曼滤波的问题，这里我就不介绍卡尔曼滤波的背景了，直接介绍最基础的卡尔曼滤波（KF）。</p><div class=mermaid>%%{init: {'theme':'base', 'themeVariables': { 'edgeLabelBackground':'#ffffff', 'lineColor':'#d0d0d0'}}}%%
graph TB
A["卡尔曼滤波家族<br>------<br>贝叶斯递推框架<br>预测 → 更新"]
A -.-> B["线性高斯系统"]
A -.-> C["非线性高斯系统"]
A -.-> D["集合方法"]
A -.-> E["非高斯/任意分布"]
A -.-> F["多模型方法"]
A -.-> G["自适应与鲁棒方法"]
B -.-> B1["KF<br>标准卡尔曼滤波"]
B -.-> B2["IF<br>信息滤波"]
B -.-> B3["RTS<br>固定间隔平滑器"]
C -.-> C1["近似线性化"]
C -.-> C2["无迹变换"]
C -.-> C3["数值稳定"]
C1 -.-> C11["EKF<br>扩展卡尔曼<br>一阶线性化"]
C1 -.-> C12["IEKF<br>迭代扩展卡尔曼"]
C2 -.-> C21["UKF<br>无迹卡尔曼<br>Sigma点"]
C2 -.-> C22["CKF<br>Cubature卡尔曼<br>球积规则"]
C3 -.-> C31["SR-KF<br>平方根卡尔曼"]
C3 -.-> C32["SR-UKF<br>平方根无迹卡尔曼"]
D -.-> D1["EnKF<br>集合卡尔曼<br>样本协方差"]
D -.-> D2["EnKS<br>集合平滑器"]
D1 -.-> D11["随机EnKF"]
D1 -.-> D12["确定性EnKF"]
E -.-> E1["PF<br>粒子滤波<br>SIS/SIR"]
E -.-> E2["RBPF<br>边缘化粒子滤波"]
E2 -.-> E21["线性部分: KF"]
E2 -.-> E22["非线性部分: 粒子"]
F -.-> F1["IMM<br>交互多模型"]
F1 -.-> F11["IMM-KF"]
F1 -.-> F12["IMM-EKF"]
F1 -.-> F13["IMM-UKF"]
G -.-> G1["AKF<br>自适应卡尔曼<br>在线估参"]
G -.-> G2["H∞滤波<br>最坏情况界"]
G -.-> G3["鲁棒KF<br>M-estimator"]
classDef level0 fill:#4A90E2,stroke:#2E5C8A,stroke-width:2.5px,color:#fff,font-weight:bold
classDef level1 fill:#7CB9E8,stroke:#5A8FC7,stroke-width:2px,color:#000
classDef level2 fill:#B3D9F2,stroke:#8AB8E0,stroke-width:1.5px,color:#000
classDef level3 fill:#E6F2FA,stroke:#B8D9EE,stroke-width:1px,color:#333
class A level0
class B,C,D,E,F,G level1
class B1,B2,B3,C1,C2,C3,D1,D2,E1,E2,F1,G1,G2,G3 level2
class C11,C12,C21,C22,C31,C32,D11,D12,E21,E22,F11,F12,F13 level3</div><p>卡尔曼滤波，用直白的话来讲，就是：多个不确定的结果，经过分析、推理和计算，获得相对准确的结果。</p><ul><li>多个是指数据来源可以是模型推理得出，也可以是通过仪器测量获得。</li><li>不确定是指由于模型本身是一种近似，或者是测量仪器本身的精度误差，或者测量过程不可避免地引入了噪声，甚至因为所需要的特征无法直接获取，只能间接推导获得。</li><li>分析、推理和计算，则指的是卡尔曼滤波算法，也是本文接下来将会重点阐述的部分。</li><li>相对准确，指的是经过卡尔曼滤波算法获得的结果，比原有的多个不确定的结果更逼近客观真实值，但依然存在误差。</li></ul><h2 class="relative group">原理<div id=原理 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e5%8e%9f%e7%90%86 aria-label=锚点>#</a></span></h2><h3 class="relative group">数学基础与符号约定<div id=数学基础与符号约定 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%95%b0%e5%ad%a6%e5%9f%ba%e7%a1%80%e4%b8%8e%e7%ac%a6%e5%8f%b7%e7%ba%a6%e5%ae%9a aria-label=锚点>#</a></span></h3><p>下面的内容不需要在事前理解，只需要在遇到新内容的时候查询即可。</p><ol start=0><li>加粗的小写字母表示向量（通常为列向量），如 $\mathbf{x}_{k}$、$\mathbf{u}_{k}$。</li><li>加粗的大写字母表示矩阵，如 $\mathbf{F}$、$\mathbf{B}$、$\mathbf{H}$、$\mathbf{Q}$、$\mathbf{R}$。</li><li>头顶为<code>^</code>的字母表示估计值（后验估计），如 $\hat{\mathbf{x}}_{k}$。</li><li>右上角为<code>-</code>的字母表示预测值（先验估计），如 $\mathbf{x}_{k}^{-}$。</li><li>期望（表示数据分布的中心位置）：对于离散随机向量 $\mathbf{X}$，其期望为 $E[\mathbf{X}] = \sum_{i=1}^{n} \mathbf{X}_{i} P(\mathbf{X}_{i})$（连续情形为积分形式）。</li><li>协方差矩阵（表示数据分布的不确定性和形状，在卡尔曼滤波中度量后验估计值的精确程度）：对于随机向量 $\mathbf{X}$，其协方差矩阵为 $Cov(\mathbf{X}) = E[(\mathbf{X} - E[\mathbf{X}])(\mathbf{X} - E[\mathbf{X}])^{T}]$。</li><li>先验：指在获得新证据之前，对未知事件的预先判断、信念或概率。</li><li>后验：指在获得新证据之后，将新证据与先验判断结合，得出的更新后的判断、信念或概率。</li><li>转置：对于矩阵 $\mathbf{A}$，其转置为 $\mathbf{A}^{T}$。</li><li>单位矩阵：$\mathbf{I}$，是方阵，且对角线上的元素为 1，其余元素为 0。</li><li>迹：对于矩阵 $\mathbf{A}$，其迹为 $tr(\mathbf{A}) = \sum_{i=1}^{n} \mathbf{A}_{ii}$。</li><li>逆：对于方阵 $\mathbf{A}$，其逆矩阵记为 $\mathbf{A}^{-1}$，满足 $\mathbf{A}\mathbf{A}^{-1} = \mathbf{A}^{-1}\mathbf{A} = \mathbf{I}$。</li></ol><h3 class="relative group">基本模型<div id=基本模型 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e5%9f%ba%e6%9c%ac%e6%a8%a1%e5%9e%8b aria-label=锚点>#</a></span></h3><p>（线性）卡尔曼滤波的应用基于以下三个假设前提：</p><ol><li>马尔可夫性：当前时刻状态只和上一时刻状态有关。</li><li>线性模型：系统的状态转移和观测过程均满足线性关系。</li><li>高斯噪声：过程噪声和测量噪声都符合高斯分布。</li></ol><p>基于上述假设，我们可以得到如下两个公式：</p>$$
过程模型： \mathbf{x}_{k} = \mathbf{F}_{k} \mathbf{x}_{k-1} + \mathbf{B}_{k} \mathbf{u}_{k} + \mathbf{w}_{k-1} \quad\quad ①
$$$$
观测模型： \mathbf{z}_{k} = \mathbf{H}_{k} \mathbf{x}_{k} + \mathbf{v}_{k} \quad\quad ②
$$<p>其中：</p><ul><li>$\mathbf{x}_{k}$ 表示 $k$ 时刻的真实状态值，是待估计的未知量；</li><li>$\mathbf{x}_{k-1}$ 表示 $k-1$ 时刻的真实状态值；</li><li>$\mathbf{u}_{k}$ 表示 $k$ 时刻的控制输入量（作用于区间 $(k-1, k]$），描述在 $k-1$ 时刻至 $k$ 时刻这段时间里生效的输入；</li><li>$\mathbf{w}_{k-1}$ 表示过程噪声，其均值为 $0$，协方差矩阵为 $\mathbf{Q}_{k-1}$，即 $\mathbf{w}_{k-1} \sim N(0, \mathbf{Q}_{k-1})$；</li><li>$\mathbf{z}_{k}$ 表示 $k$ 时刻的观测值，是已知的测量量；</li><li>$\mathbf{v}_{k}$ 表示观测噪声，其均值为 $0$，协方差矩阵为 $\mathbf{R}_{k}$，即 $\mathbf{v}_{k} \sim N(0, \mathbf{R}_{k})$；</li><li>$\mathbf{F}_{k}$ 表示状态转移矩阵，描述状态如何从 $k-1$ 时刻演化到 $k$ 时刻；</li><li>$\mathbf{B}_{k}$ 表示控制矩阵，描述区间 $(k-1, k]$ 内生效的控制输入 $\mathbf{u}_{k}$ 如何影响 $k$ 时刻的状态；</li><li>$\mathbf{H}_{k}$ 表示观测矩阵，描述系统的 $k$ 时刻真实状态 $\mathbf{x}_{k}$ 与我们得到的测量值 $\mathbf{z}_{k}$ 之间的关系；</li></ul><p>然而现实中，我们无法得到真实的噪声 $\mathbf{w}_{k-1}$ 和 $\mathbf{v}_{k}$ ，因此即便我们建立了精确的模型，也无法得到准确的真实状态值 $\mathbf{x}_{k}$。所以我们希望找到一个最优估计值 $\hat{\mathbf{x}}_{k}$ 来尽可能地逼近 $\mathbf{x}_{k}$，使得估计误差最小。</p><h3 class="relative group">预测步骤：推导先验估计值<div id=预测步骤推导先验估计值 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e9%a2%84%e6%b5%8b%e6%ad%a5%e9%aa%a4%e6%8e%a8%e5%af%bc%e5%85%88%e9%aa%8c%e4%bc%b0%e8%ae%a1%e5%80%bc aria-label=锚点>#</a></span></h3><p>根据过程模型 ① $\mathbf{x}_{k} = \mathbf{F}_{k} \mathbf{x}_{k-1} + \mathbf{B}_{k} \mathbf{u}_{k} + \mathbf{w}_{k-1}$，我们可以对 $k$ 时刻的状态进行预测。</p><p>由于我们无法得知上一时刻的真实状态 $\mathbf{x}_{k-1}$ 和当前的过程噪声 $\mathbf{w}_{k-1}$，因此我们使用上一时刻的最优估计值 $\hat{\mathbf{x}}_{k-1}$ 来代替 $\mathbf{x}_{k-1}$。同时，由于过程噪声 $\mathbf{w}_{k-1}$ 的期望为零，在预测时我们取其期望值，即 $E[\mathbf{w}_{k-1}]=0$。</p><p>由此，我们得到 $k$ 时刻状态的先验估计值（预测值） $\mathbf{x}_{k}^{-}$ 的计算公式：</p>$$
\mathbf{x}_{k}^{-} = \mathbf{F}_{k} \hat{\mathbf{x}}_{k-1} + \mathbf{B}_{k} \mathbf{u}_{k}
$$<p>其中：</p><ul><li>$\mathbf{x}_{k}^{-}$ 表示 $k$ 时刻状态的预测值，也叫先验估计值（因为它是在获得 $k$ 时刻测量值之前计算的）；</li><li>$\hat{\mathbf{x}}_{k-1}$ 表示 $k-1$ 时刻的最优估计值（后验估计值）；</li><li>$\mathbf{u}_{k}$ 表示 $k$ 时刻的控制输入量（作用于区间 $(k-1, k]$）；</li><li>$\mathbf{F}_{k}$ 表示状态转移矩阵，描述真实状态 $\mathbf{x}$ 如何从 $k-1$ 时刻演化到 $k$ 时刻；</li><li>$\mathbf{B}_{k}$ 表示控制矩阵，描述在区间 $(k-1, k]$ 生效的控制输入 $\mathbf{u}_{k}$ 如何影响 $k$ 时刻的状态 $\mathbf{x}$；</li></ul><p>这个预测值 $\mathbf{x}_{k}^{-}$ 仅仅基于系统的动态模型和上一时刻的状态估计，它没有包含当前 $k$ 时刻的任何测量信息。因此，它是一个有待修正的初步估计。下一步，我们将利用 $k$ 时刻的测量值 $\mathbf{z}_{k}$ 来修正这个预测值，以获得更精确的后验估计值 $\hat{\mathbf{x}}_{k}$。</p><h3 class="relative group">更新步骤：融合测量值修正预测<div id=更新步骤融合测量值修正预测 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%9b%b4%e6%96%b0%e6%ad%a5%e9%aa%a4%e8%9e%8d%e5%90%88%e6%b5%8b%e9%87%8f%e5%80%bc%e4%bf%ae%e6%ad%a3%e9%a2%84%e6%b5%8b aria-label=锚点>#</a></span></h3><p>在预测步骤中，我们得到了一个 $k$ 时刻的先验预测值 $\mathbf{x}_{k}^{-}$。这个值仅基于系统模型和上一时刻的状态，尚未利用 $k$ 时刻的测量数据。现在，我们的任务是利用 $k$ 时刻的实际测量值 $\mathbf{z}_{k}$ 来修正这个预测，从而得到一个更准确的后验估计值 $\hat{\mathbf{x}}_{k}$。</p><p>修正的核心思路是比较“实际测量”与“预测的测量”之间的差距。</p><ol><li>$k$ 时刻的实际测量值：$\mathbf{z}_{k}$</li><li>$k$ 时刻的预测测量值：$\mathbf{H}_{k}\mathbf{x}_{k}^{-}$（这是将状态预测值 $\mathbf{x}_{k}^{-}$ 通过观测模型 $\mathbf{H}_{k}$ 映射到测量空间得到的值）</li></ol><p>$k$ 时刻的实际测量值 $\mathbf{z}_{k}$ 与 $k$ 时刻的预测测量值 $\mathbf{H}_{k}\mathbf{x}_{k}^{-}$ 之差，被称为测量残差（Innovation） $Y_{k}$：</p>$$
Y_{k} = \mathbf{z}_{k} - \mathbf{H}_{k}\mathbf{x}_{k}^{-}
$$<p>这个测量残差 $Y_{k}$ 反映了我们的预测与现实的差距。如果残差很小，说明预测准确；如果残差很大，则说明预测存在较大偏差，需要进行显著修正。</p><p>卡尔曼滤波通过一个核心的状态更新方程来完成修正，该方程将最终的后验估计值表示为先验预测值与加权后的测量残差之和：</p>$$
状态更新方程： \hat{\mathbf{x}}_{k} = \mathbf{x}_{k}^{-} + \mathbf{K}_{k}(\mathbf{z}_{k} - \mathbf{H}_{k}\mathbf{x}_{k}^{-}) \quad\quad ③
$$<p>其中：</p><ul><li>$\hat{\mathbf{x}}_{k}$ 是 $k$ 时刻的最优估计值（或称后验估计值），因为它融合了 $k$ 时刻的测量信息。</li><li>$\mathbf{K}_{k}$ 是卡尔曼增益。它的核心作用是一个权重矩阵，用于权衡我们应该在多大程度上相信“预测值”和“测量值”。<ul><li>如果测量噪声很大（即我们不信任测量值），$\mathbf{K}_{k}$ 的值会变小，我们就更倾向于相信预测值 $\mathbf{x}_{k}^{-}$。</li><li>如果预测本身很不确定（即我们不信任预测值），$\mathbf{K}_{k}$ 的值会变大，我们就更倾向于利用测量信息进行大幅修正。</li></ul></li></ul><p>至此，状态更新的逻辑已经建立。即从 $k-1$ 时刻的后验估计值 $\hat{\mathbf{x}}_{k-1}$ 经过 $k$ 时刻状态的先验估计值（预测值） $\mathbf{x}_{k}^{-}$ 到 $k$ 时刻的最优估计值 $\hat{\mathbf{x}}_{k}$ 的更新过程已经完成。</p><p>但卡尔曼增益 $\mathbf{K}_{k}$ 还是未知的，后续的推导将致力于如何计算这个使估计误差最小的最优卡尔曼增益 $\mathbf{K}_{k}$。</p><h3 class="relative group">目标函数的建立与转化<div id=目标函数的建立与转化 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%9b%ae%e6%a0%87%e5%87%bd%e6%95%b0%e7%9a%84%e5%bb%ba%e7%ab%8b%e4%b8%8e%e8%bd%ac%e5%8c%96 aria-label=锚点>#</a></span></h3><p>将上述思路转化为数学语言，我们首先定义后验估计误差 $\mathbf{e}_{k} = \mathbf{x}_{k} - \hat{\mathbf{x}}_{k}$，即 $k$ 时刻真实状态值与后验估计值的差。卡尔曼滤波的目标是寻找一个最优的增益矩阵 $\mathbf{K}_k$ 来最小化该误差的均方值 $E[||\mathbf{e}_k||^2]$。</p><p>这个均方误差可以通过后验误差协方差矩阵 $\mathbf{P}_{k}$ 的迹来表示，其中 $\mathbf{P}_{k}$ 定义为：</p>$$
\mathbf{P}_{k} = E[\mathbf{e}_{k}\mathbf{e}_{k}^{T}]
$$<p>它们之间的关系如下：</p>$$
E[||\mathbf{e}_k||^2] = E[\mathbf{e}_k^T \mathbf{e}_k] = \text{tr}(E[\mathbf{e}_k \mathbf{e}_k^T]) = \text{tr}(\mathbf{P}_k)
$$<p>因此，优化目标函数可以明确地表示为：</p>$$
\min_{\mathbf{K}_k}{\text{tr}(\mathbf{P}_{k})}
$$<p>为了求解这个最小化问题，我们需要推导出 $\mathbf{P}_{k}$ 关于 $\mathbf{K}_{k}$ 的具体表达式。这需要我们先从 $\mathbf{e}_{k}$ 的表达式入手。根据状态更新方程 ③ $\hat{\mathbf{x}}_{k} = \mathbf{x}_{k}^{-} + \mathbf{K}_{k}(\mathbf{z}_{k} - \mathbf{H}_{k}\mathbf{x}_{k}^{-})$ 和观测模型 ② $\mathbf{z}_{k} = \mathbf{H}_{k} \mathbf{x}_{k} + \mathbf{v}_{k}$，我们有：</p>$$
\begin{aligned}
\mathbf{e}_{k} &= \mathbf{x}_{k} - \hat{\mathbf{x}}_{k} \\
&= \mathbf{x}_{k} - \left( \mathbf{x}_{k}^{-} + \mathbf{K}_{k}(\mathbf{z}_{k} - \mathbf{H}_{k}\mathbf{x}_{k}^{-}) \right) \\
&= (\mathbf{x}_{k} - \mathbf{x}_{k}^{-}) - \mathbf{K}_{k}(\mathbf{H}_{k}\mathbf{x}_{k} + \mathbf{v}_{k}-\mathbf{H}_{k}\mathbf{x}_{k}^{-} ) \\
&= (\mathbf{x}_{k} - \mathbf{x}_{k}^{-}) - \mathbf{K}_{k}\mathbf{H}_{k}(\mathbf{x}_{k} - \mathbf{x}_{k}^{-}) - \mathbf{K}_{k}\mathbf{v}_{k} \\
&= (\mathbf{I} - \mathbf{K}_{k}\mathbf{H}_{k})(\mathbf{x}_{k} - \mathbf{x}_{k}^{-} ) - \mathbf{K}_{k}\mathbf{v}_{k}
\end{aligned}
$$<p>为简化表示，我们引入先验估计误差 $\mathbf{e}_{k}^{-} = \mathbf{x}_{k} - \mathbf{x}_{k}^{-}$（$k$ 时刻真实状态值与先验估计值的差），则上式变为：</p>$$
\mathbf{e}_{k} = (\mathbf{I} - \mathbf{K}_{k}\mathbf{H}_{k})\mathbf{e}_{k}^{-} - \mathbf{K}_{k}\mathbf{v}_{k} \quad\quad ④
$$<p>现在，我们可以利用公式 ④ 来计算后验误差协方差矩阵 $\mathbf{P}_{k}$。在这个过程中，我们还需要用到先验误差协方差矩阵 $\mathbf{P}_{k}^{-}$，其定义为：</p>$$
\mathbf{P}_{k}^{-} = E[\mathbf{e}_{k}^{-}\mathbf{e}_{k}^{-T}]
$$<p>根据协方差矩阵的定义，$\mathbf{P}_{k}$ 和 $\mathbf{P}_{k}^{-}$ 都是对称矩阵。对公式 ④ 两边乘以其自身的转置，并取期望，可得：</p>$$
\begin{aligned}
\mathbf{P}_{k} &= E[\mathbf{e}_{k} \mathbf{e}_{k}^{T}] \\
&= E\!\left[ \big((\mathbf{I} - \mathbf{K}_{k}\mathbf{H}_{k})\mathbf{e}_{k}^{-} - \mathbf{K}_{k}\mathbf{v}_{k}\big) \big((\mathbf{I} - \mathbf{K}_{k}\mathbf{H}_{k})\mathbf{e}_{k}^{-} - \mathbf{K}_{k}\mathbf{v}_{k}\big)^{T} \right] \\
&= (\mathbf{I} - \mathbf{K}_{k}\mathbf{H}_{k})\mathbf{P}_{k}^{-}(\mathbf{I} - \mathbf{K}_{k}\mathbf{H}_{k})^{T} + \mathbf{K}_{k}\mathbf{R}_{k}\mathbf{K}_{k}^{T} \\
&= \mathbf{P}_{k}^{-} - \mathbf{K}_{k}\mathbf{H}_{k}\mathbf{P}_{k}^{-} - \mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}\mathbf{K}_{k}^{T} + \mathbf{K}_{k}(\mathbf{H}_{k}\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}+\mathbf{R}_{k})\mathbf{K}_{k}^{T} \quad\quad ⑤
\end{aligned}
$$<p>其中，$\mathbf{R}_{k}$ 是测量噪声协方差。</p><p>至此，我们将随机变量的最优化问题转化成为了关于矩阵 $\mathbf{K}_k$ 的函数最小化问题。很多文章在此直接对后验误差协方差矩阵 $\mathbf{P}_{k}$ 取迹，然后对卡尔曼增益 $\mathbf{K}_k$ 求导，并令其为零，以获得使 $\text{tr}(\mathbf{P}_{k})$ 最小的 $\mathbf{K}_k$ 值。如此做的理由有以下三点：</p><ol><li>$\text{tr}(\mathbf{P}_{k})$ 在物理上表示系统状态估计误差的总方差，即均方误差 $E[||\mathbf{e}_k||^2]$。最小化迹就是最小化整体的估计误差能量，这是一个非常直观且合理的优化目标。</li><li>$\text{tr}(\mathbf{P}_{k})$ 是关于 $\mathbf{K}_k$ 的一个标量函数，并且可以证明它是一个二次函数，因此是凸函数，存在唯一的全局最小值。</li><li>对标量函数 $\text{tr}(\mathbf{P}_{k})$ 进行矩阵求导（$\frac{\partial \text{tr}(\mathbf{P}_{k})}{\partial \mathbf{K}_k}$）比直接对矩阵 $\mathbf{P}_{k}$ 求导要简单得多，并且有成熟的矩阵迹求导法则（如 $\frac{\partial \text{tr}(AB)}{\partial A} = B^T$）可以使用。</li></ol><div class="expand-wrapper prose dark:prose-invert max-w-prose zen-mode-content"><input id=expand-0 class=expand-toggle type=checkbox>
<label for=expand-0 class=expand-title><span class=expand-icon><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg>
</span>上述三点的扩展证明</label><div class=expand-content><div class=expand-inner><ol><li><p>$ \text{tr}(\mathbf{P}_{k}) = \sum_{i=1}^{n} E[(x_{ik}-\hat{x}_{ik})^{2}] $</p><p>$\text{tr}(\mathbf{P}_{k})$ 表示的是后验误差协方差矩阵 $\mathbf{P}_{k}$ 主对角线元素之和，在<code>估计无偏</code>时，恰好是状态向量所有分量估计误差的均方误差（Mean Squared Error）之和。在卡尔曼滤波中，我们的目标是找到最优的增益 $K_k$，使得这个均方误差总和最小，这是一个典型的最小均方误差（MMSE）优化问题。</p><p>为了更直观地理解，我们将 $\mathbf{P}_{k}$ 以矩阵形式展开（假设状态向量维度为 $n$）：</p>$$
\mathbf{P}_{k}=\begin{pmatrix} E[(x_{1k}-\hat{x}_{1k} )^{2}] & E[(x_{1k}-\hat{x}_{1k} )(x_{2k}-\hat{x}_{2k} )] & \cdots & E[(x_{1k}-\hat{x}_{1k} )(x_{nk}-\hat{x}_{nk} )] \\ E[(x_{2k}-\hat{x}_{2k} )(x_{1k}-\hat{x}_{1k} )] & E[(x_{2k}-\hat{x}_{2k} )^{2}] & \cdots & E[(x_{2k}-\hat{x}_{2k} )(x_{nk}-\hat{x}_{nk} )] \\ \vdots & \vdots & \ddots & \vdots \\ E[(x_{nk}-\hat{x}_{nk} )(x_{1k}-\hat{x}_{1k} )] & E[(x_{nk}-\hat{x}_{nk} )(x_{2k}-\hat{x}_{2k} )] & \cdots & E[(x_{nk}-\hat{x}_{nk} )^{2}]\end{pmatrix}
$$</li><li><p>标量函数（迹）对矩阵求导的基础知识</p><p>我们来推导 $\frac{\partial \text{tr}(\mathbf{A}\mathbf{X})}{\partial \mathbf{X}} = \mathbf{A}^{T}$。设 $\mathbf{A}$、$\mathbf{X}$ 均为 $n \times n$ 的方阵，且 $\mathbf{A}$ 与 $\mathbf{X}$ 无关。</p><p>根据矩阵乘法和迹的定义，我们有：</p>$$
\text{tr}(\mathbf{A}\mathbf{X}) = \sum_{i=1}^{n} (\mathbf{A}\mathbf{X})_{ii} = \sum_{i=1}^{n} \sum_{j=1}^{n} a_{ij}x_{ji}
$$<p>标量函数 $f(\mathbf{X})$ 对矩阵 $\mathbf{X}$ 的导数定义如下（按分母布局）：</p>$$
\frac{\partial f(\mathbf{X})}{\partial \mathbf{X} } =\begin{pmatrix} \frac{\partial f}{\partial x_{11}} &\frac{\partial f}{\partial x_{12}} &\cdots &\frac{\partial f}{\partial x_{1n}} \\ \frac{\partial f}{\partial x_{21}} & \frac{\partial f}{\partial x_{22}}& \cdots &\frac{\partial f}{\partial x_{2n}} \\ \vdots & \vdots & \ddots & \vdots \\ \frac{\partial f}{\partial x_{n1}} & \frac{\partial f}{\partial x_{n2}} &\cdots & \frac{\partial f}{\partial x_{nn}} \end{pmatrix}
$$<p>现在，我们求迹 $\text{tr}(\mathbf{A}\mathbf{X})$ 对 $\mathbf{X}$ 的任意一个元素 $x_{kl}$ 的偏导数：</p>$$
\frac{\partial \text{tr}(\mathbf{A}\mathbf{X})}{\partial x_{kl}} = \frac{\partial}{\partial x_{kl}} \left( \sum_{i=1}^{n} \sum_{j=1}^{n} a_{ij}x_{ji} \right)
$$<p>在这个双重求和中，变量 $x_{kl}$ 只在 $j=k$ 且 $i=l$ 这一项中出现，该项为 $a_{lk}x_{kl}$。因此，对 $x_{kl}$ 求导的结果就是它的系数 $a_{lk}$。</p><p>所以，导数矩阵的第 $k$ 行第 $l$ 列的元素为：</p>$$
\left(\frac{\partial \text{tr}(\mathbf{A}\mathbf{X})}{\partial \mathbf{X}}\right)_{kl} = a_{lk} = (\mathbf{A}^T)_{kl}
$$<p>由于这对所有的 $k, l$ 都成立，我们得到：</p>$$
\frac{\partial \text{tr}(\mathbf{A}\mathbf{X})}{\partial \mathbf{X}} = \mathbf{A}^{T}
$$</li><li><p>类比 2 的推导过程，我们不加证明地给出以下关于迹的求导结论：</p><ul><li>结论 1： $\frac{\partial \text{tr}(\mathbf{A}\mathbf{X})}{\partial \mathbf{X}} = \mathbf{A}^{T}$</li><li>结论 2： $\frac{\partial \text{tr}(\mathbf{X}\mathbf{A})}{\partial \mathbf{X}} = \mathbf{A}^{T}$（利用 $\text{tr}(\mathbf{X}\mathbf{A})=\text{tr}(\mathbf{A}\mathbf{X})$）</li><li>结论 3： $\frac{\partial \text{tr}(\mathbf{X}\mathbf{A}\mathbf{X}^{T})}{\partial \mathbf{X}} = \mathbf{X}(\mathbf{A}+\mathbf{A}^{T})$</li><li>结论 4： $\frac{\partial \text{tr}(\mathbf{X}^{T}\mathbf{A}\mathbf{X})}{\partial \mathbf{X}} = (\mathbf{A}+\mathbf{A}^{T})\mathbf{X}$</li><li>结论 5： 对于任何一个作为 $\mathbf{X}$ 函数的矩阵 $\mathbf{P}(\mathbf{X})$，恒有 $\frac{\partial \text{tr}(\mathbf{P})}{\partial \mathbf{X}} = \frac{\partial \text{tr}(\mathbf{P}^{T})}{\partial \mathbf{X}}$，因为矩阵的迹等于其转置的迹。</li></ul></li></ol></div></div></div><h3 class="relative group">卡尔曼增益求解和协方差矩阵化简<div id=卡尔曼增益求解和协方差矩阵化简 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e5%8d%a1%e5%b0%94%e6%9b%bc%e5%a2%9e%e7%9b%8a%e6%b1%82%e8%a7%a3%e5%92%8c%e5%8d%8f%e6%96%b9%e5%b7%ae%e7%9f%a9%e9%98%b5%e5%8c%96%e7%ae%80 aria-label=锚点>#</a></span></h3><p>根据上述扩展知识，我们求解最优卡尔曼增益 $\mathbf{K}_{k}$，</p>$$
\begin{align}
令 \frac{\partial \text{tr}(\mathbf{P}_{k})}{\partial \mathbf{K}_{k}} &= \frac{\partial \text{tr}(\mathbf{P}_{k}^{-}) }{\partial \mathbf{K}_{k}} -\frac{\partial \text{tr}(\mathbf{K}_{k}\mathbf{H}_{k}\mathbf{P}_{k}^{-})}{\partial \mathbf{K}_{k}}-\frac{\partial \text{tr}(\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}\mathbf{K}_{k}^{T})}{\partial \mathbf{K}_{k}}+\frac{\partial \text{tr}(\mathbf{K}_{k}(\mathbf{H}_{k}\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}+\mathbf{R}_{k})\mathbf{K}_{k}^{T})}{\partial \mathbf{K}_{k}} \\
&= 0 - (\mathbf{H}_{k}\mathbf{P}_{k}^{-})^{T} - (\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}) + 2\mathbf{K}_{k}(\mathbf{H}_{k}\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}+\mathbf{R}_{k}) \\
&= -2\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T} + 2\mathbf{K}_{k}(\mathbf{H}_{k}\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}+\mathbf{R}_{k}) \\
&= 0
\end{align}
$$<p>我们得到</p>$$
\mathbf{K}_{k} = \mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}(\mathbf{H}_{k}\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}+\mathbf{R}_{k})^{-1} \quad\quad ⑥
$$<p>其中， $\mathbf{R}_{k}$ 是测量噪声协方差。</p><p>代入到后验误差协方差公式 $\mathbf{P}_{k} = (\mathbf{I}-\mathbf{K}_{k}\mathbf{H}_{k})\mathbf{P}_{k}^{-}(\mathbf{I}-\mathbf{K}_{k}\mathbf{H}_{k})^T + \mathbf{K}_{k}\mathbf{R}_{k}\mathbf{K}_{k}^T$ 中，展开后可得：$\mathbf{P}_{k} = \mathbf{P}_{k}^{-} - \mathbf{K}_{k}\mathbf{H}_{k}\mathbf{P}_{k}^{-} - \mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}\mathbf{K}_{k}^{T} + \mathbf{K}_{k}(\mathbf{H}_{k}\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}+\mathbf{R}_{k})\mathbf{K}_{k}^{T}$。</p><p>利用公式 ⑥ 的结论 $\mathbf{K}_{k}(\mathbf{H}_{k}\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}+\mathbf{R}_{k}) = \mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}$，对上式进行化简，则有后验误差协方差矩阵：</p>$$
\begin{align}
\mathbf{P}_{k} &= \mathbf{P}_{k}^{-} - \mathbf{K}_{k}\mathbf{H}_{k}\mathbf{P}_{k}^{-} - \mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}\mathbf{K}_{k}^{T} + (\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T})\mathbf{K}_{k}^{T} \\
&= \mathbf{P}_{k}^{-} - \mathbf{K}_{k}\mathbf{H}_{k}\mathbf{P}_{k}^{-} \\
&= (\mathbf{I}-\mathbf{K}_{k}\mathbf{H}_{k})\mathbf{P}_{k}^{-} \quad\quad ⑦
\end{align}
$$<p>借鉴上述整个推导过程，对于由运动模型得到的 $k$ 时刻状态的先验估计值（预测值）公式 $\mathbf{x}_{k}^{-} = \mathbf{F}_{k} \hat{\mathbf{x}}_{k-1} + \mathbf{B}_{k}\mathbf{u}_{k}$。</p><p>为了构建先验误差 $\mathbf{e}_{k}^{-}$，按定义两式相减：</p>$$
\begin{align}
\mathbf{e}_{k}^{-} &= \mathbf{x}_{k}-\mathbf{x}_{k}^{-} \\
&= \mathbf{x}_{k}-\mathbf{F}_{k} \hat{\mathbf{x}}_{k-1} - \mathbf{B}_{k}\mathbf{u}_{k} \\
&= \mathbf{F}_{k} \mathbf{x}_{k-1} + \mathbf{B}_{k}\mathbf{u}_{k} +\mathbf{w}_{k-1}-\mathbf{F}_{k} \hat{\mathbf{x}}_{k-1} - \mathbf{B}_{k}\mathbf{u}_{k} \\
&= \mathbf{F}_{k}( \mathbf{x}_{k-1}-\hat{\mathbf{x}}_{k-1})+\mathbf{w}_{k-1}
\end{align}
$$<p>即</p>$$
\mathbf{e}_{k}^{-} = \mathbf{F}_{k}\mathbf{e}_{k-1}+\mathbf{w}_{k-1}
$$<p>类似构建后验误差协方差矩阵 $\mathbf{P}_{k}$ 的方式，同样构建先验误差协方差矩阵 $\mathbf{P}_{k}^{-}$，两边同时乘以自身的转置并取期望，再考虑到 $\mathbf{w}_{k-1}$ 和 $\mathbf{e}_{k-1}$ 互相独立（即 $E[\mathbf{F}_{k}\mathbf{e}_{k-1}\mathbf{w}_{k-1}^T]=0$），有</p>$$
\begin{aligned}
E[\mathbf{e}_{k}^{-}\mathbf{e}_{k}^{-T}] &= E\!\left[(\mathbf{F}_{k}\mathbf{e}_{k-1}+\mathbf{w}_{k-1})(\mathbf{F}_{k}\mathbf{e}_{k-1}+\mathbf{w}_{k-1})^{T}\right] \\
&= \mathbf{F}_{k}\,E[\mathbf{e}_{k-1}\mathbf{e}_{k-1}^{T}]\,\mathbf{F}_{k}^{T}+E[\mathbf{w}_{k-1}\mathbf{w}_{k-1}^{T}]
\end{aligned}
$$<p>则有先验误差协方差矩阵：</p>$$
\mathbf{P}_{k}^{-}= \mathbf{F}_{k}\mathbf{P}_{k-1}\mathbf{F}_{k}^{T}+\mathbf{Q}_{k-1} \quad\quad ⑧
$$<p>其中， $\mathbf{Q}_{k-1}$ 为过程噪声协方差。</p><p>至此，我们已经获得了完整的卡尔曼滤波预测、更新的公式。</p><h3 class="relative group">梳理<div id=梳理 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%a2%b3%e7%90%86 aria-label=锚点>#</a></span></h3><p>我们对上文做一个系统性的总结。</p><p>首先，我们对实际问题进行建模，获得运动模型和观测模型：</p><p>运动模型： $\mathbf{x}_{k} = \mathbf{F}_{k} \mathbf{x}_{k-1} + \mathbf{B}_{k}\mathbf{u}_{k} +\mathbf{w}_{k-1} \quad\quad ①$</p><p>观测模型： $\mathbf{z}_{k} = \mathbf{H}_{k} \mathbf{x}_{k} +\mathbf{v}_{k} \quad\quad ②$</p><p>其中，$\mathbf{w}_{k-1}$ 和 $\mathbf{v}_{k}$ 分别是过程噪声和观测噪声，它们是互不相关的高斯白噪声，其协方差矩阵分别为 $\mathbf{Q}_{k-1}$ 和 $\mathbf{R}_{k}$。</p><p>其次，我们通过无偏估计的假设和误差定义，获得最优估计值和协方差矩阵的表达式（更新步骤）：</p><p>状态更新： $\hat{\mathbf{x}}_{k} = \mathbf{x}_{k}^{-} + \mathbf{K}_{k}(\mathbf{z}_{k}-\mathbf{H}_{k}\mathbf{x}_{k}^{-} ) \quad\quad ③$</p><p>后验误差： $\mathbf{e}_{k} = (\mathbf{I} -\mathbf{K}_{k}\mathbf{H}_{k})\mathbf{e}_{k}^{-} - \mathbf{K}_{k}\mathbf{v}_{k} \quad\quad ④$</p><p>后验误差协方差矩阵（展开形式）： $\mathbf{P}_{k} = E[\mathbf{e}_{k}\mathbf{e}_{k}^{T}]= \mathbf{P}_{k}^{-} - \mathbf{K}_{k}\mathbf{H}_{k}\mathbf{P}_{k}^{-}-\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}\mathbf{K}_{k}^{T} + \mathbf{K}_{k}(\mathbf{H}_{k}\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}+\mathbf{R}_{k})\mathbf{K}_{k}^{T} \quad\quad ⑤$</p><p>再次，我们通过最小化后验误差协方差矩阵 $\mathbf{P}_{k}$ 的迹，推导出卡尔曼增益：</p><p>卡尔曼增益： $\mathbf{K}_{k}=\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}(\mathbf{H}_{k}\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}+\mathbf{R}_{k})^{-1} \quad\quad ⑥$</p><p>将上式代入 ⑤ 并化简，可得后验误差协方差矩阵的更简洁形式：</p><p>后验误差协方差矩阵（常用形式）： $\mathbf{P}_{k} = (\mathbf{I}-\mathbf{K}_{k}\mathbf{H}_{k})\mathbf{P}_{k}^{-} \quad\quad ⑦$</p><p>最后，我们进行预测步骤，计算下一时刻的先验量：</p><p>先验误差协方差矩阵： $\mathbf{P}_{k}^{-}= \mathbf{F}_{k}\mathbf{P}_{k-1}\mathbf{F}_{k}^{T}+\mathbf{Q}_{k-1} \quad\quad ⑧$</p><p>状态预测： $\mathbf{x}_{k}^{-} = \mathbf{F}_{k} \hat{\mathbf{x}}_{k-1} + \mathbf{B}_{k}\mathbf{u}_{k} \quad\quad ⑨$</p><p>先验误差： $\mathbf{e}_{k}^{-} = \mathbf{F}_{k}\mathbf{e}_{k-1}+\mathbf{w}_{k-1}$</p><h3 class="relative group">总结<div id=总结 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%80%bb%e7%bb%93 aria-label=锚点>#</a></span></h3><p>那么，卡尔曼滤波就可以按下面的 5 个公式理解并说明：</p><p>实现过程：使用上一次的最优结果预测出当前值，同时使用当前观测值修正，得到当前最优结果。</p><p>我们将卡尔曼滤波的完整流程总结为两个阶段：预测和更新。</p><ul><li><p>预测</p><ol><li>预测状态
$$
\mathbf{x}_{k}^{-} = \mathbf{F}_{k} \hat{\mathbf{x}}_{k-1} + \mathbf{B}_{k} \mathbf{u}_{k} \quad\quad (1)
$$</li><li>预测先验误差协方差矩阵
$$
\mathbf{P}_{k}^{-} = \mathbf{F}_{k}\mathbf{P}_{k-1}\mathbf{F}_{k}^{T} + \mathbf{Q}_{k-1} \quad\quad (2)
$$</li></ol></li><li><p>更新</p><ol><li>计算卡尔曼增益
$$
\mathbf{K}_{k} = \mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}(\mathbf{H}_{k}\mathbf{P}_{k}^{-}\mathbf{H}_{k}^{T}+\mathbf{R}_{k})^{-1} \quad\quad (3)
$$</li><li>更新状态估计
$$
\hat{\mathbf{x}}_{k} = \mathbf{x}_{k}^{-} + \mathbf{K}_{k}(\mathbf{z}_{k} - \mathbf{H}_{k}\mathbf{x}_{k}^{-}) \quad\quad (4)
$$</li><li>更新后验误差协方差矩阵
$$
\mathbf{P}_{k} = (\mathbf{I}-\mathbf{K}_{k}\mathbf{H}_{k})\mathbf{P}_{k}^{-} \quad\quad (5)
$$</li></ol></li></ul><p>在设定好系统的模型参数（状态转移矩阵：$\mathbf{F}_k$、控制矩阵：$\mathbf{B}_k$、观测矩阵：$\mathbf{H}_k$）和噪声协方差（过程噪声协方差：$\mathbf{Q}_k$，测量噪声协方差：$\mathbf{R}_k$）后，这个预测-更新的循环从初始状态 $\hat{\mathbf{x}}_0$ 和初始误差协方差矩阵 $\mathbf{P}_0$ 开始，不断迭代，实现对系统状态的实时最优估计。</p><h2 class="relative group">实践<div id=实践 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e5%ae%9e%e8%b7%b5 aria-label=锚点>#</a></span></h2><h3 class="relative group">调节超参数<div id=调节超参数 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e8%b0%83%e8%8a%82%e8%b6%85%e5%8f%82%e6%95%b0 aria-label=锚点>#</a></span></h3><ol><li><p>过程噪声协方差：$\mathbf{Q}_k$ 和测量噪声协方差：$\mathbf{R}_k$</p></li><li><p>初始状态 $\hat{\mathbf{x}}_0$ 和初始误差协方差矩阵 $\mathbf{P}_0$</p></li></ol><h3 class="relative group">卡尔曼滤波的使用步骤<div id=卡尔曼滤波的使用步骤 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e5%8d%a1%e5%b0%94%e6%9b%bc%e6%bb%a4%e6%b3%a2%e7%9a%84%e4%bd%bf%e7%94%a8%e6%ad%a5%e9%aa%a4 aria-label=锚点>#</a></span></h3><ol><li>选择状态量、观测量</li><li>构建方程</li><li>初始化参数（$\mathbf{Q}_k$、$\mathbf{R}_k$、$\hat{\mathbf{x}}_0$（一般取 0）、$\mathbf{P}_0$（一般取 1，不可为 0））</li><li>代入公式迭代</li><li>调节超参数（$\mathbf{Q}_k$、$\mathbf{R}_k$）</li></ol><h3 class="relative group">案例分析一：一维时序信号的追踪与滤波<div id=案例分析一一维时序信号的追踪与滤波 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%a1%88%e4%be%8b%e5%88%86%e6%9e%90%e4%b8%80%e4%b8%80%e7%bb%b4%e6%97%b6%e5%ba%8f%e4%bf%a1%e5%8f%b7%e7%9a%84%e8%bf%bd%e8%b8%aa%e4%b8%8e%e6%bb%a4%e6%b3%a2 aria-label=锚点>#</a></span></h3><p>本节将以一个常见的工程问题——从带噪声的观测中恢复纯净的正弦信号——为例，详细演示如何为特定问题构建卡尔曼滤波模型。核心挑战在于，正弦波本身并非一个简单的动态系统，我们需要通过数学推导，将其转换为卡尔曼滤波框架所要求的线性状态空间形式。</p><h4 class="relative group">对应代码和演示视频<div id=对应代码和演示视频 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e5%af%b9%e5%ba%94%e4%bb%a3%e7%a0%81%e5%92%8c%e6%bc%94%e7%a4%ba%e8%a7%86%e9%a2%91 aria-label=锚点>#</a></span></h4><p>请直接下载： <a href=./code/01_kalman_filter_sine_wave.ipynb>01_kalman_filter_sine_wave.ipynb</a></p><style>.video-caption>*{margin:0!important;padding:0;line-height:1.5}</style><figure class=my-6 style=max-width:85%;margin-left:auto;margin-right:auto><figcaption class="video-caption text-center text-base text-neutral-700 dark:text-neutral-200 font-semibold" style=margin-bottom:.25rem>卡尔曼滤波正弦波跟踪演示（Q=1.0e-05, R=0.16）</figcaption><div class="w-full rounded-md shadow-lg" style=margin:0;padding:0;line-height:0><video class="w-full h-auto rounded-md nozoom" style=display:block;margin:0;padding:0 controls preload=metadata>
<source src="/posts/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2/code/01-DEMO-Q=1.0e-05-R=0.16.mp4" type=video/mp4>您的浏览器不支持 video 标签。</video></div></figure><h4 class="relative group">第一步：建立信号的动态模型<div id=第一步建立信号的动态模型 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%bb%ba%e7%ab%8b%e4%bf%a1%e5%8f%b7%e7%9a%84%e5%8a%a8%e6%80%81%e6%a8%a1%e5%9e%8b aria-label=锚点>#</a></span></h4><p>卡尔曼滤波要求系统满足马尔可夫性，即当前状态仅与上一状态有关。幸运的是，一个纯净的、离散采样的正弦波，其未来值 $y_{t+1}$ 可以由它当前和过去的值 $y_t$, $y_{t-1}$ 精确地线性表示。我们的首要任务就是找到这个线性递推关系。</p><p>我们从离散正弦波的定义出发：</p>$$
y_t = A \sin(\omega t + \phi)
$$<p>其中 $\omega$ 是数字角频率（ $\omega = 2\pi f / f_s$ ，f 是信号频率， $f_s$ 是采样频率）。</p><p>我们写出 $t+1$ 和 $t-1$ 时刻的表达式：</p><ol><li>$y_{t+1} = A \sin(\omega(t+1) + \phi) = A \sin((\omega t+\phi) + \omega)$</li><li>$y_{t-1} = A \sin(\omega(t-1) + \phi) = A \sin((\omega t+\phi) - \omega)$</li></ol><p>使用三角函数的和角公式 $\sin(\alpha \pm \beta) = \sin(\alpha)\cos(\beta) \pm \cos(\alpha)\sin(\beta)$ 展开上述两式：</p><ol><li>$y_{t+1} = A [\sin(\omega t+\phi)\cos(\omega) + \cos(\omega t+\phi)\sin(\omega)]$</li><li>$y_{t-1} = A [\sin(\omega t+\phi)\cos(\omega) - \cos(\omega t+\phi)\sin(\omega)]$</li></ol><p>将这两个式子相加，$\cos(\omega t+\phi)\sin(\omega)$ 项会正负抵消：</p>$$
y_{t+1} + y_{t-1} = 2 A \sin(\omega t+\phi) \cos(\omega)
$$<p>注意到 $A \sin(\omega t+\phi)$ 正好就是 $y_t$，将其代入上式：</p>$$
y_{t+1} + y_{t-1} = 2 y_t \cos(\omega)
$$<p>整理得到 $y_{t+1}$ 的表达式，这便是我们需要的线性递推关系：</p>$$
y_{t+1} = 2\cos(\omega) y_t - y_{t-1}
$$<p>这个公式是建模的关键。它揭示了正弦信号内在的、二阶的线性动态特性，为我们构建状态转移模型铺平了道路。</p><h4 class="relative group">第二步：构建状态空间方程<div id=第二步构建状态空间方程 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e6%9e%84%e5%bb%ba%e7%8a%b6%e6%80%81%e7%a9%ba%e9%97%b4%e6%96%b9%e7%a8%8b aria-label=锚点>#</a></span></h4><p>我们得到的递推关系是二阶的（依赖于 $y_t$ 和 $y_{t-1}$ ），而标准卡尔曼滤波的状态转移是一阶的（$\mathbf{x}_k = \mathbf{F}_k \mathbf{x}_{k-1} + \dots$）。解决这个问题的经典方法是“状态增广”：通过增加状态向量的维度，将高阶系统转化为一阶系统。</p><ol><li><p>定义状态向量 $\mathbf{x}_t$
为实现一阶递推，状态向量必须包含计算 $y_{t+1}$ 所需的所有历史信息，即 $y_t$ 和 $y_{t-1}$。因此，我们定义 $t$ 时刻的状态向量为：</p>$$
\mathbf{x}_t = \begin{bmatrix} y_t \\ y_{t-1} \end{bmatrix}
$$</li><li><p>构建状态转移矩阵 $\mathbf{F}$
我们的目标是找到一个 2x2 矩阵 $\mathbf{F}$，使得 $\mathbf{x}_{t+1} = \mathbf{F} \mathbf{x}_t$ 成立。首先写出 $\mathbf{x}_{t+1}$ 的定义：</p>$$
\mathbf{x}_{t+1} = \begin{bmatrix} y_{t+1} \\ y_t \end{bmatrix}
$$<p>现在，将状态方程展开：</p>$$
\begin{bmatrix} y_{t+1} \\ y_t \end{bmatrix} = \begin{bmatrix} F_{11} & F_{12} \\ F_{21} & F_{22} \end{bmatrix} \begin{bmatrix} y_t \\ y_{t-1} \end{bmatrix}
$$<p>我们逐行确定 $\mathbf{F}$ 的元素：</p><ul><li>第一行：$y_{t+1} = F_{11} y_t + F_{12} y_{t-1}$
根据第一步的递推关系 $y_{t+1} = (2\cos(\omega)) y_t + (-1) y_{t-1}$，可得：
$F_{11} = 2\cos(\omega)$ 和 $F_{12} = -1$</li><li>第二行：$y_t = F_{21} y_t + F_{22} y_{t-1}$
这是一个恒等关系：$t+1$ 时刻状态的第二个元素（$y_t$）就是 $t$ 时刻状态的第一个元素。所以：
$y_t = (1) y_t + (0) y_{t-1}$
可得：$F_{21} = 1$ 和 $F_{22} = 0$</li></ul><p>组合起来，我们就得到了状态转移矩阵 $\mathbf{F}$：</p>$$ \mathbf{F} = \begin{bmatrix} 2\cos(\omega) & -1 \\ 1 & 0 \end{bmatrix} $$</li></ol><h4 class="relative group">第三步：定义观测模型<div id=第三步定义观测模型 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%ac%ac%e4%b8%89%e6%ad%a5%e5%ae%9a%e4%b9%89%e8%a7%82%e6%b5%8b%e6%a8%a1%e5%9e%8b aria-label=锚点>#</a></span></h4><p>模型建立的最后一步是关联我们定义的内部状态与外部的实际测量值。</p><ol><li><p>定义观测量 $\mathbf{z}_t$
在我们的问题中，每次的测量值 $\mathbf{z}_t$ 就是带有噪声的、当前时刻的正弦波幅值。</p></li><li><p>构建观测矩阵 $\mathbf{H}$
我们需要一个矩阵 $\mathbf{H}$，它能从状态向量 $\mathbf{x}_t = \begin{bmatrix} y_t \\ y_{t-1} \end{bmatrix}$ 中“提取”出我们理论上要测量的值 $y_t$。</p>$$
\mathbf{z}_t \approx \mathbf{H} \mathbf{x}\_t = \begin{bmatrix} H_1 & H_2 \end{bmatrix} \begin{bmatrix} y_t \\ y_{t-1} \end{bmatrix} = H_1 y_t + H_2 y_{t-1}
$$<p>为了让 $\mathbf{H} \mathbf{x}_t$ 等于 $y_t$，我们只需令 $H_1 = 1$ 和 $H_2 = 0$。因此，观测矩阵 $\mathbf{H}$ 是：</p>$$
\mathbf{H} = \begin{bmatrix} 1 & 0 \end{bmatrix}
$$</li></ol><h4 class="relative group">模型总结<div id=模型总结 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%a8%a1%e5%9e%8b%e6%80%bb%e7%bb%93 aria-label=锚点>#</a></span></h4><p>至此，我们成功地将一个看似复杂的正弦波信号，转化为了标准的线性高斯系统模型，可以完美地套用卡尔曼滤波的五个核心公式。</p><ul><li><p>过程模型：$\mathbf{x}_{k} = \mathbf{F} \mathbf{x}_{k-1} + \mathbf{w}_{k-1}$</p><ul><li>状态向量 $\mathbf{x}_{k} = \begin{bmatrix} y_k \\ y_{k-1} \end{bmatrix}$，代表信号当前和上一时刻的真实值。</li><li>状态转移矩阵 $\mathbf{F} = \begin{bmatrix} 2\cos(\omega) & -1 \\ 1 & 0 \end{bmatrix}$，描述了正弦波的内在演化规律。</li><li>过程噪声 $\mathbf{w}_{k-1}$ 代表了模型的不确定性（例如频率的微小漂移），其协方差为 $\mathbf{Q}$。</li></ul></li><li><p>观测模型：$\mathbf{z}_{k} = \mathbf{H} \mathbf{x}_{k} + \mathbf{v}_{k}$</p><ul><li>观测矩阵 $\mathbf{H} = \begin{bmatrix} 1 & 0 \end{bmatrix}$，表示我们只能直接测量到信号的当前值。</li><li>观测噪声 $\mathbf{v}_{k}$ 代表了传感器的测量误差，其协方差为 $\mathbf{R}$。</li></ul></li></ul><p>在实际应用中，我们只需根据信号的频率确定 $\omega$ 并设置好 $\mathbf{F}$ 矩阵，再根据经验调节噪声协方差 $\mathbf{Q}$ 和 $\mathbf{R}$，就可以实现对带噪正弦波的高效滤波。</p><h3 class="relative group">案例分析二：二维平面运动轨迹的估计与预测<div id=案例分析二二维平面运动轨迹的估计与预测 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%a1%88%e4%be%8b%e5%88%86%e6%9e%90%e4%ba%8c%e4%ba%8c%e7%bb%b4%e5%b9%b3%e9%9d%a2%e8%bf%90%e5%8a%a8%e8%bd%a8%e8%bf%b9%e7%9a%84%e4%bc%b0%e8%ae%a1%e4%b8%8e%e9%a2%84%e6%b5%8b aria-label=锚点>#</a></span></h3><p>在许多实际应用中，如雷达跟踪、视频监控或机器人导航，我们都需要根据一系列不精确的观测点来估计目标的真实运动轨迹。本节将以一个在二维平面上做近似匀加速运动的目标为例，展示如何构建卡尔曼滤波器来实时估计其精确的位置和速度，并对未来位置进行预测。</p><h4 class="relative group">对应代码<div id=对应代码 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e5%af%b9%e5%ba%94%e4%bb%a3%e7%a0%81 aria-label=锚点>#</a></span></h4><p>请直接下载： <a href=./code/02_kalman_filter_2d_tracking.ipynb>02_kalman_filter_2d_tracking.ipynb</a></p><h4 class="relative group">第一步：建立目标的动态模型<div id=第一步建立目标的动态模型 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%bb%ba%e7%ab%8b%e7%9b%ae%e6%a0%87%e7%9a%84%e5%8a%a8%e6%80%81%e6%a8%a1%e5%9e%8b aria-label=锚点>#</a></span></h4><p>我们假设目标在每个采样时间间隔 $\Delta t$ 内，其加速度是近似恒定的，但会受到一些随机扰动（例如，轻微的机动、空气阻力变化等）。基于牛顿运动学定律，我们可以建立目标的状态模型。</p><ol><li><p>定义状态向量 $\mathbf{x}_k$
为了完整描述目标在二维平面上的运动状态，我们需要知道它的位置和速度。因此，状态向量应包含 $x$ 和 $y$ 两个方向上的位置和速度分量：</p>$$
\mathbf{x}_k = \begin{bmatrix} p_{x,k} \\ p_{y,k} \\ v_{x,k} \\ v_{y,k} \end{bmatrix}
$$<p>其中，$p$ 代表位置 (position)，$v$ 代表速度 (velocity)。</p></li><li><p>构建状态转移矩阵 $\mathbf{F}$
状态转移矩阵 $\mathbf{F}$ 描述了在没有噪声的情况下，状态如何从 $k-1$ 时刻演化到 $k$ 时刻。根据匀加速运动公式：</p><ul><li>$p_k = p_{k-1} + v_{k-1}\Delta t + \frac{1}{2}a_{k-1}\Delta t^2$</li><li>$v_k = v_{k-1} + a_{k-1}\Delta t$</li></ul><p>为简化模型，我们通常将加速度作为过程噪声的一部分来处理，而不是直接放入状态向量。这被称为恒速模型 (Constant Velocity, CV)，它假设在每个 $\Delta t$ 内速度恒定。这个模型足以应对大多数机动性不强的目标。</p><ul><li>$p_{x,k} = p_{x,k-1} + v_{x,k-1}\Delta t$</li><li>$p_{y,k} = p_{y,k-1} + v_{y,k-1}\Delta t$</li><li>$v_{x,k} = v_{x,k-1}$</li><li>$v_{y,k} = v_{y,k-1}$</li></ul><p>将上述关系写成矩阵形式 $\mathbf{x}_k = \mathbf{F} \mathbf{x}_{k-1}$：</p>$$
\begin{bmatrix} p_{x,k} \\ p_{y,k} \\ v_{x,k} \\ v_{y,k} \end{bmatrix} =
\begin{bmatrix}
1 & 0 & \Delta t & 0 \\
0 & 1 & 0 & \Delta t \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix} p_{x,k-1} \\ p_{y,k-1} \\ v_{x,k-1} \\ v_{y,k-1} \end{bmatrix}
$$<p>因此，状态转移矩阵为：</p>$$
\mathbf{F} = \begin{bmatrix}
1 & 0 & \Delta t & 0 \\
0 & 1 & 0 & \Delta t \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$</li><li><p>定义过程噪声协方差矩阵 $\mathbf{Q}$
恒速模型是一个近似。目标的实际运动会因为未建模的加速度（随机扰动）而偏离该模型。过程噪声 $\mathbf{w}_{k-1}$ 正是用来描述这种不确定性。</p><p>一个常用的方法是假设加速度是一个零均值、方差为 $\sigma_a^2$ 的随机过程。加速度在 $\Delta t$ 时间内对位置和速度的影响分别是 $\frac{1}{2}a\Delta t^2$ 和 $a\Delta t$。经过推导，可以得到一个适用于离散时间系统的过程噪声协方差矩阵 $\mathbf{Q}$：</p>$$
\mathbf{Q} = \begin{bmatrix}
\frac{\Delta t^4}{4} & 0 & \frac{\Delta t^3}{2} & 0 \\
0 & \frac{\Delta t^4}{4} & 0 & \frac{\Delta t^3}{2} \\
\frac{\Delta t^3}{2} & 0 & \Delta t^2 & 0 \\
0 & \frac{\Delta t^3}{2} & 0 & \Delta t^2
\end{bmatrix} \sigma_a^2
$$<p>其中 $\sigma_a^2$ 是一个可调节的超参数，代表了我们对目标机动能力（即加速度变化剧烈程度）的预估。$\sigma_a^2$ 越大，滤波器对模型预测的信任度就越低，从而更依赖于测量值。</p></li></ol><h4 class="relative group">第二步：定义观测模型<div id=第二步定义观测模型 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%ae%9a%e4%b9%89%e8%a7%82%e6%b5%8b%e6%a8%a1%e5%9e%8b aria-label=锚点>#</a></span></h4><p>接下来，我们需要建立内部状态与外部测量之间的关系。</p><ol><li><p>定义观测量 $\mathbf{z}_k$
假设我们的传感器（如 GPS 或摄像头）只能直接测量目标的位置，而无法直接测量其速度。因此，观测向量为：</p>$$
\mathbf{z}_k = \begin{bmatrix} p_{x, measured} \\ p_{y, measured} \end{bmatrix}
$$</li><li><p>构建观测矩阵 $\mathbf{H}$
观测矩阵 $\mathbf{H}$ 的作用是从状态向量 $\mathbf{x}_k$ 中提取出与观测量相对应的部分。</p>$$
\mathbf{z}_k \approx \mathbf{H} \mathbf{x}_k = \mathbf{H} \begin{bmatrix} p_{x,k} \\ p_{y,k} \\ v_{x,k} \\ v_{y,k} \end{bmatrix}
$$<p>为了提取出位置信息 $(p_{x,k}, p_{y,k})$，$\mathbf{H}$ 矩阵应为：</p>$$
\mathbf{H} = \begin{bmatrix}
1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0
\end{bmatrix}
$$</li><li><p>定义测量噪声协方差矩阵 $\mathbf{R}$
任何传感器都存在测量误差。我们假设 $x$ 和 $y$ 方向的测量噪声是独立的，并且都服从高斯分布，其方差分别为 $\sigma_x^2$ 和 $\sigma_y^2$。这些值通常可以从传感器的规格手册中获得。</p>$$
\mathbf{R} = \begin{bmatrix}
\sigma_x^2 & 0 \\
0 & \sigma_y^2
\end{bmatrix}
$$</li></ol><h4 class="relative group">模型总结<div id=模型总结-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%a8%a1%e5%9e%8b%e6%80%bb%e7%bb%93-1 aria-label=锚点>#</a></span></h4><p>通过以上步骤，我们为二维目标跟踪问题构建了完整的卡尔曼滤波模型：</p><ul><li><p>过程模型：$\mathbf{x}_{k} = \mathbf{F} \mathbf{x}_{k-1} + \mathbf{w}_{k-1}$</p><ul><li>状态向量 $\mathbf{x}_{k}$ 包含了位置和速度信息。</li><li>状态转移矩阵 $\mathbf{F}$ 基于恒速运动模型。</li><li>过程噪声协方差 $\mathbf{Q}$ 反映了目标随机机动的可能性。</li></ul></li><li><p>观测模型：$\mathbf{z}_{k} = \mathbf{H} \mathbf{x}_{k} + \mathbf{v}_{k}$</p><ul><li>观测矩阵 $\mathbf{H}$ 表明我们只能测量到位置。</li><li>测量噪声协方差 $\mathbf{R}$ 代表了传感器的精度。</li></ul></li></ul><p>将这些矩阵代入卡尔曼滤波的五个核心公式，我们就可以通过迭代，从一系列带噪声的位置观测中，得到平滑的、包含速度信息的状态估计，从而实现对目标轨迹的精确跟踪和未来位置的短期预测。</p><h3 class="relative group">案例分析三：三维空间中的刚体姿态跟踪问题<div id=案例分析三三维空间中的刚体姿态跟踪问题 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%a1%88%e4%be%8b%e5%88%86%e6%9e%90%e4%b8%89%e4%b8%89%e7%bb%b4%e7%a9%ba%e9%97%b4%e4%b8%ad%e7%9a%84%e5%88%9a%e4%bd%93%e5%a7%bf%e6%80%81%e8%b7%9f%e8%b8%aa%e9%97%ae%e9%a2%98 aria-label=锚点>#</a></span></h3><p>前面两个案例展示了卡尔曼滤波在线性系统中的强大威力。然而，当我们将目光投向更复杂的现实世界问题，如无人机飞行姿态、机器人手臂末端朝向或卫星在轨姿态的估计时，我们会遇到一个根本性的挑战： 旋转运动本质上是非线性的。</p><p>本节将探讨为什么三维姿态跟踪问题无法直接套用标准卡尔曼滤波，并简述解决此类问题的基本思路，以此展示标准 KF 的局限性，并引出卡尔曼滤波家族中的非线性分支。</p><h4 class="relative group">第一步：姿态的数学表示<div id=第一步姿态的数学表示 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%a7%bf%e6%80%81%e7%9a%84%e6%95%b0%e5%ad%a6%e8%a1%a8%e7%a4%ba aria-label=锚点>#</a></span></h4><p>与位置可以用简单的向量 $(x, y, z)$ 表示不同，描述三维空间中的姿态（旋转）要复杂得多。常用的表示方法有：</p><ol><li>欧拉角（Euler Angles）：如滚转-俯仰-偏航角 $(\phi, \theta, \psi)$。这种表示直观，但在特定姿态（如俯仰角为 ±90°）时会出现万向节死锁（Gimbal Lock）问题，导致奇异性，无法正确表示旋转。</li><li>旋转矩阵（Rotation Matrix）：一个 3x3 的正交矩阵 $\mathbf{C}$。它没有奇异性，但有 9 个参数，而姿态只有 3 个自由度，这带来了冗余和约束（$\mathbf{C}^T\mathbf{C} = \mathbf{I}, \det(\mathbf{C})=1$），计算复杂。</li><li>四元数（Quaternion）：一个四维向量 $\mathbf{q} = [q_w, q_x, q_y, q_z]^T$，满足范数为 1 的约束（$||\mathbf{q}||=1$）。它既没有奇异性，也比旋转矩阵更紧凑，计算效率高，是姿态动力学中最常用的表示方法。</li></ol><p>无论选择哪种表示，姿态的演化规律都无法用一个简单的线性方程 $\mathbf{x}_k = \mathbf{F}\mathbf{x}_{k-1}$ 来描述。</p><h4 class="relative group">第二步：非线性的根源——姿态运动学<div id=第二步非线性的根源姿态运动学 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e9%9d%9e%e7%ba%bf%e6%80%a7%e7%9a%84%e6%a0%b9%e6%ba%90%e5%a7%bf%e6%80%81%e8%bf%90%e5%8a%a8%e5%ad%a6 aria-label=锚点>#</a></span></h4><p>刚体的姿态变化率（角速度）与姿态本身的关系是非线性的。以四元数为例，其随时间变化的微分方程为：</p>$$
\dot{\mathbf{q}}(t) = \frac{1}{2} \mathbf{\Omega}(\boldsymbol{\omega}(t)) \mathbf{q}(t)
$$<p>其中，$\mathbf{q}(t)$ 是姿态四元数，$\boldsymbol{\omega}(t) = [\omega_x, \omega_y, \omega_z]^T$ 是机体坐标系下的角速度向量，而 $\mathbf{\Omega}(\boldsymbol{\omega})$ 是一个与角速度相关的斜对称矩阵：</p>$$
\mathbf{\Omega}(\boldsymbol{\omega}) =
\begin{bmatrix}
0 & -\omega_x & -\omega_y & -\omega_z \\
\omega_x & 0 & \omega_z & -\omega_y \\
\omega_y & -\omega_z & 0 & \omega_x \\
\omega_z & \omega_y & -\omega_x & 0
\end{bmatrix}
$$<p>这是一个典型的非线性微分方程，因为状态的导数 $\dot{\mathbf{q}}$ 是状态 $\mathbf{q}$ 和输入 $\boldsymbol{\omega}$ 的乘积。将其离散化后，得到的状态转移方程 $\mathbf{q}_k = f(\mathbf{q}_{k-1}, \boldsymbol{\omega}_{k-1})$ 也是一个复杂的非线性函数，无法表示为 $\mathbf{F}\mathbf{q}_{k-1}$ 的形式。</p><h4 class="relative group">第三步：非线性的观测模型<div id=第三步非线性的观测模型 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%ac%ac%e4%b8%89%e6%ad%a5%e9%9d%9e%e7%ba%bf%e6%80%a7%e7%9a%84%e8%a7%82%e6%b5%8b%e6%a8%a1%e5%9e%8b aria-label=锚点>#</a></span></h4><p>姿态的观测通常也呈非线性。例如，无人机通过加速度计和磁力计来确定姿态：</p><ul><li>加速度计：在静止时测量重力向量 $\mathbf{g}$ 的方向。</li><li>磁力计：测量地球磁场向量 $\mathbf{m}$ 的方向。</li></ul><p>当无人机姿态为 $\mathbf{q}$ 时，它在机体坐标系下观测到的重力向量 $\mathbf{a}_{body}$ 和磁场向量 $\mathbf{m}_{body}$ 是通过姿态将世界坐标系下的参考向量 $\mathbf{g}_{world}$ 和 $\mathbf{m}_{world}$ 旋转得到的。这个旋转操作本身就是非线性的。观测模型可以写为：</p>$$
\mathbf{z}_k = \begin{bmatrix} \mathbf{a}_{body} \\ \mathbf{m}_{body} \end{bmatrix} = h(\mathbf{q}_k) + \mathbf{v}_k =
\begin{bmatrix}
\mathbf{C}(\mathbf{q}_k)^T \mathbf{g}_{world} \\
\mathbf{C}(\mathbf{q}_k)^T \mathbf{m}_{world}
\end{bmatrix} + \mathbf{v}_k
$$<p>其中 $\mathbf{C}(\mathbf{q}_k)$ 是从四元数 $\mathbf{q}_k$ 转换得到的旋转矩阵。显然，这里的观测函数 $h(\cdot)$ 是一个复杂的非线性函数，无法用一个固定的观测矩阵 $\mathbf{H}$ 来表示。</p><h4 class="relative group">挑战与解决思路<div id=挑战与解决思路 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%8c%91%e6%88%98%e4%b8%8e%e8%a7%a3%e5%86%b3%e6%80%9d%e8%b7%af aria-label=锚点>#</a></span></h4><p>由于过程模型 $f(\cdot)$ 和观测模型 $h(\cdot)$ 都是非线性的，标准卡尔曼滤波的基石——线性假设——被打破了。高斯分布经过非线性变换后不再是高斯分布，这使得协方差矩阵的传播和更新公式失效。</p><p>为了解决这个问题，工程师和数学家们发展出了卡尔曼滤波的非线性扩展版本：</p><ol><li><p>扩展卡尔曼滤波 (Extended Kalman Filter, EKF)</p><ul><li>核心思想：在当前状态的估计值附近，使用泰勒级数展开将非线性函数 $f(\cdot)$ 和 $h(\cdot)$ 线性化。具体来说，是用它们的雅可比矩阵 (Jacobian Matrix) 来代替标准 KF 中的 $\mathbf{F}$ 和 $\mathbf{H}$ 矩阵。</li><li>优点：实现相对简单，计算量适中。</li><li>缺点：线性化会引入截断误差，仅在系统“近似线性”时效果较好。对于强非线性系统，可能会导致滤波发散。</li></ul></li><li><p>无迹卡尔曼滤波 (Unscented Kalman Filter, UKF)</p><ul><li>核心思想：放弃直接对非线性函数进行线性化，而是采用一种更巧妙的方法——无迹变换 (Unscented Transform)。它通过一组精心选择的“Sigma 点”来近似状态的概率分布，将这些点通过真实的非线性函数传递，然后重新计算变换后的均值和协方差。</li><li>优点：精度通常比 EKF 高（至少到二阶），无需计算复杂的雅可比矩阵，对强非线性系统更鲁棒。</li><li>缺点：计算量比 EKF 稍大，参数选择（如 Sigma 点的分布参数）需要一些经验。</li></ul></li></ol><h4 class="relative group">总结<div id=总结-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%80%bb%e7%bb%93-1 aria-label=锚点>#</a></span></h4><p>三维姿态跟踪问题是通向高级滤波算法的门户。它深刻地揭示了标准卡尔曼滤波的适用边界，并清晰地指明了学习路径：当面临非线性系统时，我们需要从 EKF 和 UKF 等工具箱中寻找解决方案。这正是卡尔曼滤波家族如此庞大且充满活力的原因所在。</p><h2 class="relative group">结语<div id=结语 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%bb%93%e8%af%ad aria-label=锚点>#</a></span></h2><p>至此，我们已经完整地走过了标准卡尔曼滤波（KF）的“深入浅出”之旅。从其作为贝叶斯滤波在线性高斯系统下的特例出发，我们详细推导了预测与更新两大阶段的五个核心公式。通过一维正弦波追踪和二维平面运动跟踪这两个经典案例，我们不仅巩固了理论知识，更学会了如何将实际问题抽象、建模为卡尔曼滤波能够处理的状态空间形式。</p><p>然而，正如第三个案例“三维空间姿态跟踪”所揭示的，现实世界中充满了非线性问题。当系统的状态转移或观测过程无法用简单的矩阵乘法来描述时，标准卡尔曼滤波的线性假设便不再成立，其性能也会急剧下降甚至发散。</p><p>这恰恰是卡尔曼滤波家族精彩的延伸所在。为了应对非线性挑战，研究者们提出了多种近似最优的解决方案，其中最负盛名的便是扩展卡尔曼滤波 (Extended Kalman Filter, EKF) 和无迹卡尔曼滤波 (Unscented Kalman Filter, UKF) 。</p><p>希望本文为你打开了通往状态估计理论的大门。在“常见算法深入浅出”系列的下一篇文章中，我们将继续深入探索 EKF 与 UKF 的世界，解开它们在非线性系统中的滤波之谜。</p><h2 class="relative group"><em>参考资料</em><div id=参考资料 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 aria-label=锚点>#</a></span></h2><div class="expand-wrapper prose dark:prose-invert max-w-prose zen-mode-content"><input id=expand-2 class=expand-toggle type=checkbox>
<label for=expand-2 class=expand-title><span class=expand-icon><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg>
</span>点击展开查看参考资料</label><div class=expand-content><div class=expand-inner><ul><li><a href=https://zhuanlan.zhihu.com/p/649997859 target=_blank>深入浅出理解卡尔曼滤波【实例、公式、代码和图】</a></li><li><a href=https://zh.wikipedia.org/wiki/%e5%8d%a1%e5%b0%94%e6%9b%bc%e6%bb%a4%e6%b3%a2 target=_blank>wikipedia-zh-卡尔曼滤波</a></li><li><a href=https://www.bilibili.com/video/BV1Rh41117MT/ target=_blank>从放弃到精通！卡尔曼滤波从理论到实践~</a></li><li><a href=https://github.com/pykalman/pykalman target=_blank>GitHub-pykalman</a></li><li><a href=https://www.longluo.me/blog/kalman-filter/ target=_blank>解密卡尔曼滤波(Kalman Filter)算法：深入解析卡尔曼滤波算法原理与在线可视化实例</a></li><li><a href=https://www.bilibili.com/video/BV1ez4y1X7eR target=_blank>DR_CAN 卡尔曼滤波器系列视频</a></li></ul></div></div></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full me-4" width=96 height=96 alt=xiadengma src=/img/author_hu_76f37802f31e48ac.jpg data-zoom-src=/img/author.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">作者</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">xiadengma</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/xiadengma target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://xiadengma.com/ target=_blank aria-label=Link title=Link rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M172.5 131.1c55.6-55.59 148-55.59 203.6.0 50 50 57.4 129.7 16.3 187.2L391.3 319.9C381 334.2 361 337.6 346.7 327.3c-14.4-10.3-17.8-30.3-7.5-44.6L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2c-31.4-31.4-82.5-31.4-114 0L105.5 289.5c-31.51 30.6-31.51 82.5.0 114C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4 265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2c-58.4 41.1-136.3 34.5-186.29-15.4-56.469-56.5-56.469-148.1.0-204.5L172.5 131.1zM467.5 380c-56.5 56.5-148 56.5-204.5.0-50-50-56.5-128.8-15.4-186.3L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7 307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8c31.4 31.4 82.5 31.4 114 0L534.5 222.5c31.5-31.5 31.5-83.4.0-114C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58 374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24c56.5 56.46 56.5 148.06.0 204.46L467.5 380z"/></svg></span></span></a></div></div></div></div><div class=mb-10></div><details class="mt-2 mb-5 overflow-hidden rounded-lg ms-0 ps-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 -ms-5 ps-5 dark:bg-primary-800 dark:text-neutral-100">常见算法深入浅出 -
系列文章</summary><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">§ :
本文</div></details></div><script>var oid="views_posts/深入浅出卡尔曼滤波/index.md",oid_likes="likes_posts/深入浅出卡尔曼滤波/index.md"</script><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/%E4%BD%BF%E7%94%A8bark%E6%8E%A8%E9%80%81%E9%80%9A%E7%9F%A5%E5%88%B0%E4%BD%A0%E7%9A%84iphone/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;使用Bark推送通知到你的iPhone
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-05-06T11:16:28+08:00>2025年5月6日</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/lerobot-so-101-%E6%9C%BA%E6%A2%B0%E8%87%82%E5%AE%9E%E8%B7%B5/><span class=leading-6>LeRobot SO-101 机械臂实践&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-10-07T19:48:48+08:00>2025年10月7日</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-24 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label=返回顶部 title=返回顶部>&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">© 2025 <a href=https://xiadengma.com target=_blank>XIADENGMA</a> | All rights reserved | <a href=https://beian.miit.gov.cn target=_blank>浙ICP备20005376号-2</a></p><p class="text-xs text-neutral-500 dark:text-neutral-400">🛸 by Hugo & Blowfish</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script src=https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js></script><script>function css(e){return"rgb("+getComputedStyle(document.documentElement).getPropertyValue(e)+")"}mermaid.initialize({startOnLoad:!0,theme:"base",themeVariables:{background:css("--color-neutral"),primaryColor:css("--color-primary-200"),secondaryColor:css("--color-secondary-200"),tertiaryColor:css("--color-neutral-100"),primaryBorderColor:css("--color-primary-400"),secondaryBorderColor:css("--color-secondary-400"),tertiaryBorderColor:css("--color-neutral-400"),lineColor:"#ffffff",fontFamily:"ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,noto sans,sans-serif",fontSize:"16px"}}),document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){const e=document.querySelectorAll(".mermaid svg");e.forEach(e=>{const n=(new XMLSerializer).serializeToString(e),t=document.createElement("img"),s=new Blob([n],{type:"image/svg+xml"}),o=URL.createObjectURL(s);t.src=o,t.style.width="100%",t.style.maxWidth=e.getAttribute("width")||"100%",t.style.height="auto",t.alt="Mermaid diagram",e.parentNode.replaceChild(t,e),mediumZoom(t,{margin:24,background:"rgba(0,0,0,0.8)",scrollOffset:99999})})},1e3)})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://blog.xiadengma.com/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=搜索 tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="关闭 (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>