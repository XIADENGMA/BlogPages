<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>深入浅出 VAE 和 CVAE 模型 &#183; MyBlog</title><meta name=title content="深入浅出 VAE 和 CVAE 模型 &#183; MyBlog"><meta name=description content="My awesome website"><meta name=keywords content="Embodied AI,VAE,CVAE,Model,Math,"><link rel=canonical href=https://blog.xiadengma.com/posts/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAvae%E5%92%8Ccvae%E6%A8%A1%E5%9E%8B/><meta name=author content="xiadengma"><link href=https://github.com/xiadengma rel=me><link href=https://xiadengma.com/ rel=me><meta property="og:url" content="https://blog.xiadengma.com/posts/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAvae%E5%92%8Ccvae%E6%A8%A1%E5%9E%8B/"><meta property="og:site_name" content="MyBlog"><meta property="og:title" content="深入浅出 VAE 和 CVAE 模型"><meta property="og:description" content="My awesome website"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-19T02:47:15+08:00"><meta property="article:modified_time" content="2025-10-27T15:48:25+08:00"><meta property="article:tag" content="Embodied AI"><meta property="article:tag" content="VAE"><meta property="article:tag" content="CVAE"><meta property="article:tag" content="Model"><meta property="article:tag" content="Math"><meta property="og:see_also" content="https://blog.xiadengma.com/posts/%E4%B8%80%E4%BA%9B%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"><meta name=twitter:card content="summary"><meta name=twitter:title content="深入浅出 VAE 和 CVAE 模型"><meta name=twitter:description content="My awesome website"><link type=text/css rel=stylesheet href=/css/main.bundle.min.9edcd5e90f985a2f12ea6c1a3546d0f50284db262580c6808e26b387ce199f389377abb6066f1aaa0027a494415ab36d286c928e71eef8bdf413981a5410fd4a.css integrity="sha512-ntzV6Q+YWi8S6mwaNUbQ9QKE2yYlgMaAjiazh84ZnziTd6u2Bm8aqgAnpJRBWrNtKGySjnHu+L30E5gaVBD9Sg=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP+pSqMXxm6JPOUeAg==" data-copy=复制 data-copied=已复制></script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"文章","name":"深入浅出 VAE 和 CVAE 模型","headline":"深入浅出 VAE 和 CVAE 模型","inLanguage":"en","url":"https:\/\/blog.xiadengma.com\/posts\/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAvae%E5%92%8Ccvae%E6%A8%A1%E5%9E%8B\/","author":{"@type":"Person","name":"xiadengma"},"copyrightYear":"2025","dateCreated":"2025-10-19T02:47:15\u002b08:00","datePublished":"2025-10-19T02:47:15\u002b08:00","dateModified":"2025-10-27T15:48:25\u002b08:00","keywords":["Embodied AI","VAE","CVAE","Model","Math"],"mainEntityOfPage":"true","wordCount":"944"}]</script><script data-id=umami-script async src=https://analytics.umami.is/script.js data-website-id=678aa4f9-0d3a-485e-88ea-9a4e51d5aa9f></script><script type=text/javascript>document.querySelector('script[data-id="umami-script"]').addEventListener("load",function(){const e=document.head.querySelector('meta[property = "og:type"]').getAttribute("content");let t=document.head.querySelector('meta[property = "og:title"]').getAttribute("content"),n=document.head.querySelector('meta[property = "og:url"]').getAttribute("content");umami.track(e+":"+t,{url:n})})</script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}}</script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js id=MathJax-script></script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
跳过正文</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 min-h-[130px] opacity-65 bg-gradient-to-b from-neutral from-60% dark:from-neutral-800 to-transparent mix-blend-normal z-80"></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0"><div><a href=/ class=flex><span class=sr-only>MyBlog</span>
<img src=/img/logo.png width=90 height=90 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium">MyBlog</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=文章 title=文章><span class=mr-1><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></span><p class="text-base font-medium">文章</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="搜索 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="搜索 (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=文章 title=文章><div class=mr-2><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></div><p class="text-bg font-bg">文章</p></a></li></ul></div></div></div></div></div></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src=/img/background_1.svg alt="深入浅出 VAE 和 CVAE 模型" loading=eager decoding=async fetchpriority=high class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=background-blur data-image-id=background-image data-image-url=/img/background_1.svg></script><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>MyBlog</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>文章</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAvae%E5%92%8Ccvae%E6%A8%A1%E5%9E%8B/>深入浅出 VAE 和 CVAE 模型</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">深入浅出 VAE 和 CVAE 模型</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-10-19T02:47:15+08:00>2025年10月19日</time><span class="px-2 text-primary-500">&#183;</span><time datetime=2025-10-27T15:48:25+08:00>更新:2025年10月27日</time><span class="px-2 text-primary-500">&#183;</span><span>944 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>5 分钟</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/embodied-ai/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Embodied AI
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/vae/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">VAE
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/cvae/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">CVAE
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/model/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Model
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/math/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Math</span></span></a></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">目录</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#0-写在开头>0. 写在开头</a></li><li><a href=#aeautoencoder自编码器>AE（Autoencoder，自编码器）</a></li><li><a href=#vaevariational-autoencoder变分自编码器>VAE（Variational Autoencoder，变分自编码器）</a><ul><li><a href=#vae-数学推导>VAE 数学推导</a><ul><li><a href=#细化目标函数>细化目标函数</a></li><li><a href=#最小重构代价>最小重构代价</a></li><li><a href=#重参数化技巧>重参数化技巧</a></li><li><a href=#模型图>模型图</a></li></ul></li></ul></li><li><a href=#cvaeconditional-vae条件变分自编码器>CVAE（Conditional VAE，条件变分自编码器）</a><ul><li><a href=#cvae-数学推导>CVAE 数学推导</a><ul><li><a href=#极大似然>极大似然</a></li><li><a href=#两种理解方式>两种理解方式</a></li></ul></li></ul></li><li><a href=#结语>结语</a></li><li><a href=#参考资料><em>参考资料</em></a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">目录</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#0-写在开头>0. 写在开头</a></li><li><a href=#aeautoencoder自编码器>AE（Autoencoder，自编码器）</a></li><li><a href=#vaevariational-autoencoder变分自编码器>VAE（Variational Autoencoder，变分自编码器）</a><ul><li><a href=#vae-数学推导>VAE 数学推导</a><ul><li><a href=#细化目标函数>细化目标函数</a></li><li><a href=#最小重构代价>最小重构代价</a></li><li><a href=#重参数化技巧>重参数化技巧</a></li><li><a href=#模型图>模型图</a></li></ul></li></ul></li><li><a href=#cvaeconditional-vae条件变分自编码器>CVAE（Conditional VAE，条件变分自编码器）</a><ul><li><a href=#cvae-数学推导>CVAE 数学推导</a><ul><li><a href=#极大似然>极大似然</a></li><li><a href=#两种理解方式>两种理解方式</a></li></ul></li></ul></li><li><a href=#结语>结语</a></li><li><a href=#参考资料><em>参考资料</em></a></li></ul></nav></div></details><script>(function(){"use strict";const s=.33,o="#TableOfContents",i=".anchor",a='a[href^="#"]',r="li ul",c="active";let t=!1;function l(e,n){const o=window.scrollY+window.innerHeight*n,i=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],s=new Set(i.map(e=>e.getAttribute("href").substring(1)));if(t)for(let t=0;t<e.length;t++){const n=e[t];if(!s.has(n.id))continue;const o=n.getBoundingClientRect().top+window.scrollY;if(Math.abs(window.scrollY-o)<100)return n.id}for(let t=e.length-1;t>=0;t--){const n=e[t].getBoundingClientRect().top+window.scrollY;if(n<=o&&s.has(e[t].id))return e[t].id}return e.find(e=>s.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=l(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(c,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function n(){const n=document.querySelector(o);if(!n)return;const l=!0,u=[...document.querySelectorAll(i)],d=[...n.querySelectorAll(a)];l&&n.querySelectorAll(r).forEach(e=>e.style.display="none"),d.forEach(e=>{e.addEventListener("click",()=>{t=!0})});const c={toc:n,anchors:u,links:d,scrollOffset:s,collapseInactive:l};window.addEventListener("scroll",()=>e(c),{passive:!0}),window.addEventListener("hashchange",()=>e(c),{passive:!0}),e(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><details class="mt-2 mb-5 overflow-hidden rounded-lg ms-0 ps-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 -ms-5 ps-5 dark:bg-primary-800 dark:text-neutral-100">常见模型深入浅出 -
系列文章</summary><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">§ :
本文</div><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><a href=/posts/%E4%B8%80%E4%BA%9B%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/>§ :
一些数学基础概念</a></div></details><div class="article-content max-w-prose mb-20"><h2 class="relative group">0. 写在开头<div id=0-写在开头 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#0-%e5%86%99%e5%9c%a8%e5%bc%80%e5%a4%b4 aria-label=锚点>#</a></span></h2><p>在 <a href=../%e6%b7%b1%e5%85%a5%e6%b5%85%e5%87%baact%e6%a8%a1%e5%9e%8b/>ACT 模型</a> 中，我们提到了 VAE 和 CVAE。本文对这两类生成模型做一个直观梳理。</p><ul><li>VAE：把自编码器放进概率图景，用变分推断与重参数化技巧把“学习可采样的潜变量分布”转成可微的重建项 + KL 正则，从而既能压缩又能生成。</li><li>CVAE：在 VAE 的潜变量与/或解码器中显式加入条件 $c$，使生成分布变为 $p_\theta(x\mid z,c)$，从而实现受控生成（按标签、文本等定向出样本）。</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=AE+VAE+CVAE src=./img/AE+VAE+CVAE.png></figure></p><h2 class="relative group">AE（Autoencoder，自编码器）<div id=aeautoencoder自编码器 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#aeautoencoder%e8%87%aa%e7%bc%96%e7%a0%81%e5%99%a8 aria-label=锚点>#</a></span></h2><img src=./img/AE.png alt=AE width=40%><ul><li><p>结构：编码器将输入 $x$ 映射为确定性的潜在向量 $z=f_\phi(x)$；解码器重建 $\hat x=g_\theta(z)$。</p></li><li><p>训练目标：最小化重建误差（无先验与 $\mathrm{KL}$ 正则）。常见损失：</p>$$
\mathcal{L}_{\mathrm{AE}}(\theta,\phi)
= \mathbb{E}_{x\sim\mathcal{D}}\big[\ell\!\left(x,\; g_\theta\!\big(f_\phi(x)\big)\right)\big],
$$<ul><li>其中 $\ell$ 可取均方误差（MSE）或交叉熵等。</li></ul></li><li><p>作用：学习有效表示与压缩；但潜在空间往往不连续、难以平滑采样生成。</p></li></ul><h2 class="relative group">VAE（Variational Autoencoder，变分自编码器）<div id=vaevariational-autoencoder变分自编码器 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#vaevariational-autoencoder%e5%8f%98%e5%88%86%e8%87%aa%e7%bc%96%e7%a0%81%e5%99%a8 aria-label=锚点>#</a></span></h2><img src=./img/VAE.png alt=VAE width=40%><ul><li>核心想法：让编码器输出分布参数（如均值 $\mu_\phi(x)$、方差 $\sigma_\phi^2(x)$），定义近似后验 $q_\phi(z\mid x)=\mathcal N\!\big(\mu_\phi(x),\operatorname{diag}(\sigma_\phi^2(x))\big)$，再从中采样 $z$ 送入解码器。</li><li>重参数化技巧：为使采样可反传，写作
$$
z=\mu_\phi(x)+\sigma_\phi(x)\odot\varepsilon,\quad \varepsilon\sim\mathcal N(0,I).
$$</li><li>目标函数（最大化 ELBO，等价于最小化负 ELBO）：
$$
\mathcal L_{\mathrm{VAE}}(\theta,\phi)
= \mathbb{E}_{q_\phi(z\mid x)}\!\left[\log p_\theta(x\mid z)\right] - \mathrm{KL}\!\left(q_\phi(z\mid x)\,\|\,p(z)\right)
$$<ul><li>其中先验常取 $p(z)=\mathcal N(0,I)$。</li><li>第一项是重建项，鼓励复原输入；</li><li>第二项是正则项，将近似后验拉向先验，使潜在空间平滑、可插值、可采样。</li></ul></li><li>优点：潜在空间连续、可控插值与随机采样生成新样本。</li><li>局限：基本 VAE 是无条件生成，难以指定生成“某一类”样本；且重建往往偏模糊（对像素级似然的高斯假设等有关）。</li></ul><h3 class="relative group">VAE 数学推导<div id=vae-数学推导 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#vae-%e6%95%b0%e5%ad%a6%e6%8e%a8%e5%af%bc aria-label=锚点>#</a></span></h3><p>设有 $N$ 个独立同分布样本</p>$$
X=(x^1,x^2,\cdots,x^N).
$$<p>我们的目标是对生成模型的参数 $\theta$ 进行极大似然估计。似然写为 $p_\theta(X)$。在 i.i.d. 假设下，有</p>$$
\log p_\theta(X)=\sum_{i=1}^N \log p_\theta(x^i).
$$<p>先考察单个样本 $x$ 的对数似然。对于任意潜变量 $z$，恒等式</p>$$
\log p_\theta(x)=\log \frac{p_\theta(x,z)}{p_\theta(z\mid x)}
$$<p>成立（当 $p_\theta(z\mid x)>0$ 时）。</p><p>引入变分分布 $q_\phi(z\mid x)$（用以近似难以求解的后验 $p_\theta(z\mid x)$）。对上述等式两侧以 $q_\phi(z\mid x)$ 积分：</p><p>左边</p>$$
\int q_\phi(z\mid x)\,\log p_\theta(x)\,dz=\log p_\theta(x),
$$<p>右边</p>$$
\begin{aligned}
\int q_\phi(z\mid x)\,\log \frac{p_\theta(x,z)}{p_\theta(z\mid x)}\,dz
&=\int q_\phi(z\mid x)\,\log \frac{p_\theta(x,z)}{q_\phi(z\mid x)}\,dz
\;+\;\mathrm{KL}\!\left(q_\phi(z\mid x)\,\|\,p_\theta(z\mid x)\right).
\end{aligned}
$$<p>因此得到</p>$$
\log p_\theta(x)
=\underbrace{\int q_\phi(z\mid x)\,\log \frac{p_\theta(x,z)}{q_\phi(z\mid x)}\,dz}_{\text{ELBO}}
+\mathrm{KL}\!\left(q_\phi(z\mid x)\,\|\,p_\theta(z\mid x)\right).
$$<p>由 $\mathrm{KL}\ge 0$ 可知，下界（ELBO）满足</p>$$
\log p_\theta(x)\;\ge\;\mathcal{L}(\theta,\phi;x)
:=\int q_\phi(z\mid x)\,\log \frac{p_\theta(x,z)}{q_\phi(z\mid x)}\,dz.
$$<p>将联合分布按链式分解 $p_\theta(x,z)=p_\theta(x\mid z)\,p(z)$，并对 ELBO 重写为标准形式：</p>$$
\begin{aligned}
\mathcal{L}(\theta,\phi;x)
&=\mathbb{E}_{z\sim q_\phi(z\mid x)}\big[\log p_\theta(x\mid z)\big]
-\mathrm{KL}\!\left(q_\phi(z\mid x)\,\|\,p(z)\right).
\end{aligned}
$$<p>其中第一项是重构项（期望对数似然），第二项是将近似后验拉向先验的正则项。</p><p>对整批样本，目标为</p>$$
\max_{\theta,\phi}\;\sum_{i=1}^N \mathcal{L}(\theta,\phi;x^i)
=\max_{\theta,\phi}\;\sum_{i=1}^N\left(
\mathbb{E}_{z\sim q_\phi(z\mid x^i)}\big[\log p_\theta(x^i\mid z)\big]
-\mathrm{KL}\!\left(q_\phi(z\mid x^i)\,\|\,p(z)\right)\right).
$$<p>由于 $p_\theta(z\mid x)$ 难以直接计算，常用的做法是直接最大化 ELBO（等价于在固定 $x$ 与 $\theta$ 时最小化 $\mathrm{KL}\!\left(q_\phi(z\mid x)\,\|\,p_\theta(z\mid x)\right)$，因为 $\log p_\theta(x)$ 为常数）。优化方式上既可以联合对 $(\theta,\phi)$ 做梯度上升，也可以采用变分 EM 的交替策略：</p><p>步骤 ①：固定 $\theta$，更新 $\phi$，以最大化 $\mathcal{L}(\theta,\phi;x)$；</p><p>步骤 ②：固定 $\phi$，更新 $\theta$，以最大化 $\mathcal{L}(\theta,\phi;x)$。</p><p>直观上，第一项 $\mathbb{E}_{z\sim q_\phi(z\mid x)}[\log p_\theta(x\mid z)]$ 可理解为从 $q_\phi(z\mid x)$ 采样 $z$ 后的重构对数似然的期望，最大化它等价于最小化重构误差；第二项 $-\mathrm{KL}\!\left(q_\phi(z\mid x)\,\|\,p(z)\right)$ 鼓励近似后验接近先验。</p><h4 class="relative group">细化目标函数<div id=细化目标函数 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%bb%86%e5%8c%96%e7%9b%ae%e6%a0%87%e5%87%bd%e6%95%b0 aria-label=锚点>#</a></span></h4><p>证据下界（ELBO）写作：</p>$$
\mathcal{L}(x)
= \mathbb{E}_{q_\phi(z|x)}\![\log p_\theta(x|z)]- D_{KL}\!\bigl(q_\phi(z|x)\,\|\,p(z)\bigr).
$$<p>最大化 $\mathcal{L}(x)$ 等价于最小化第二项的 $D_{KL}$。取先验 $p(z)=\mathcal{N}(0,I)$，并设
$q_\phi(z|x)=\mathcal{N}\!\bigl(\mu_\phi(x),\operatorname{diag}(\sigma^2_\phi(x))\bigr)$，即各维独立的高斯近似。</p><p>对单个维度 $z_j$，记 $q(z_j|x)=\mathcal{N}(\mu,\sigma^2)$、$p(z_j)=\mathcal{N}(0,1)$（为简洁省略下标与参数），有</p>$$
\begin{aligned}
D_{KL}\bigl(q(z_j|x)\,\|\,p(z_j)\bigr)
&= \int q(z_j|x)\,\log\frac{q(z_j|x)}{p(z_j)}\,dz_j \\
&= \int q(z_j|x)\,\log
\frac{\tfrac{1}{\sqrt{2\pi}\sigma}\exp\!\left(-\tfrac{(z_j-\mu)^2}{2\sigma^2}\right)}
{\tfrac{1}{\sqrt{2\pi}}\exp\!\left(-\tfrac{z_j^2}{2}\right)}\,dz_j \\
&= \frac{1}{2}\int q(z_j|x)
\left( z_j^2 - \log\sigma^2 - \frac{(z_j-\mu)^2}{\sigma^2} \right) dz_j.
\end{aligned}
$$<p>将期望分解为三项并分别计算：</p>$$
\int q(z_j|x)\,z_j^2\,dz_j=\mathbb{E}[z_j^2]
=\operatorname{Var}(z_j)+\mathbb{E}[z_j]^2=\sigma^2+\mu^2,
$$$$
\int q(z_j|x)\,\log\sigma^2\,dz_j=\log\sigma^2,
$$$$
\int q(z_j|x)\,\frac{(z_j-\mu)^2}{\sigma^2}\,dz_j
=\frac{1}{\sigma^2}\,\mathbb{E}\!\left[(z_j-\mu)^2\right]=1.
$$<p>故单维的 KL 为</p>$$
D_{KL}\bigl(q(z_j|x)\,\|\,p(z_j)\bigr)
=\frac{1}{2}\left(\mu^2+\sigma^2-\log\sigma^2-1\right).
$$<p>在 $J$ 维独立假设下，对所有维度求和可得</p>$$
D_{KL}\bigl(q_\phi(z|x)\,\|\,p(z)\bigr)
=\frac{1}{2}\sum_{j=1}^{J}\left(\mu_j^2+\sigma_j^2-\log\sigma_j^2-1\right).
$$<p>因此，最大化 $\mathcal{L}(x)$ 等价于最小化上式；这也是 VAE 训练中常用的闭式 KL 项。</p><h4 class="relative group">最小重构代价<div id=最小重构代价 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%9c%80%e5%b0%8f%e9%87%8d%e6%9e%84%e4%bb%a3%e4%bb%b7 aria-label=锚点>#</a></span></h4><p>给定单个样本 $x$，重构项定义为</p>$$
\mathbb{E}_{z\sim q_\phi(z|x)}\!\left[\log p_\theta(x|z)\right]
= \int \log p_\theta(x|z)\, q_\phi(z|x)\,dz
\approx \frac{1}{n}\sum_{i=1}^{n} \log p_\theta\!\left(x\,\big|\,z^{(i)}\right),
$$<p>其中 $z^{(i)}\sim q_\phi(z|x)$ 是蒙特卡罗采样。</p><p>常见的假设是 $p_\theta(x|z)=\mathcal N(\mu_\theta(z),\sigma_\theta^2(z)I)$。更简单地，也可固定协方差为常数 $c>0$：</p>$$
p_\theta(x|z)=\mathcal N\!\left(f_\theta(z),\,cI\right).
$$<p>此时</p>$$
\log p_\theta(x|z)
= -\frac{D}{2}\log(2\pi) - \frac{D}{2}\log c - \frac{1}{2c}\,\|x-f_\theta(z)\|^2,
$$<p>因此最大化重构项等价于最小化均方误差的期望（忽略与 $\theta,\phi$ 无关的常数）：</p>$$
\max\,\mathbb{E}_{q_\phi}\!\left[\log p_\theta(x|z)\right]
\ \Longleftrightarrow\
\min\,\frac{1}{2c}\,\mathbb{E}_{q_\phi}\!\left[\|x-f_\theta(z)\|^2\right]
\ \approx\ \min\,\frac{1}{2c}\cdot\frac{1}{n}\sum_{i=1}^{n}\big\|x-f_\theta\!\left(z^{(i)}\right)\big\|^2.
$$<p>将其与 KL 项合并（取先验 $p(z)=\mathcal N(0,I)$，且 $q_\phi(z|x)=\mathcal N\!\big(\mu(x),\operatorname{diag}\sigma^2(x)\big)$），得到单样本的负 ELBO（待最小化）：</p>$$
\min_{\theta,\phi}\ \left[
\underbrace{\frac{1}{2}\sum_{j=1}^{J}\!\left(\sigma_j^2+\mu_j^2-\log\sigma_j^2-1\right)}_{\text{KL}\big(q_\phi(z|x)\,\|\,\mathcal N(0,I)\big)}
\ +\
\underbrace{\frac{1}{2c}\cdot\frac{1}{n}\sum_{i=1}^{n}\big\|x-f_\theta\!\left(z^{(i)}\right)\big\|^2}_{-\mathbb E_{q_\phi}\![\log p_\theta(x|z)]}
\right].
$$<p>关于可导性：直接对 $z$ 采样使得对编码器参数 $\phi$ 的梯度不可传递。为此使用重参数化技巧</p>$$
z=\mu_\phi(x)+\sigma_\phi(x)\odot\varepsilon,\qquad \varepsilon\sim\mathcal N(0,I),
$$<p>从而梯度可经由 $\varepsilon$ 的确定性变换传回编码器。</p><h4 class="relative group">重参数化技巧<div id=重参数化技巧 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e9%87%8d%e5%8f%82%e6%95%b0%e5%8c%96%e6%8a%80%e5%b7%a7 aria-label=锚点>#</a></span></h4><p>假定 $q(z\mid x)=\mathcal N(\mu,\sigma^2)$，其中 $\mu=\mu(x)$、$\sigma=\sigma(x)>0$。令
$\epsilon\sim\mathcal N(0,1)$ 且与 $x$ 独立，定义重参数化</p>$$
z=\mu+\sigma\,\epsilon.
$$<p>于是，只需先从 $\epsilon\sim\mathcal N(0,1)$ 采样，再代入上式，就得到了等价于从
$q(z\mid x)$ 采样的样本。</p><p>证明（条件于 $x$）：</p>$$
\mathbb E[z\mid x]=\mu+\sigma\,\mathbb E[\epsilon]=\mu,
$$$$
\mathrm{Var}(z\mid x)=\mathbb E\big[(z-\mu)^2\mid x\big]
=\mathbb E\big[(\sigma\epsilon)^2\mid x\big]
=\sigma^2\,\mathbb E[\epsilon^2]=\sigma^2.
$$<h4 class="relative group">模型图<div id=模型图 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%a8%a1%e5%9e%8b%e5%9b%be aria-label=锚点>#</a></span></h4><div class=mermaid>%%{init: {'theme':'base','themeVariables':{
'background':'#E8F3FF',
'primaryColor':'#FFFFFF',
'primaryBorderColor':'#3B82F6',
'primaryTextColor':'#0F172A',
'lineColor':'#2563EB',
'fontFamily':'Inter, Arial'
}}}%%
flowchart LR
%% --- Classes & link style ---
classDef node fill:#FFFFFF,stroke:#3B82F6,stroke-width:1.5px,rx:10px,ry:10px,color:#0F172A;
classDef soft fill:#F0F7FF,stroke:#60A5FA,stroke-width:1.5px,rx:10px,ry:10px,color:#0F172A;
linkStyle default stroke:#2563EB,stroke-width:2px;
%% --- Encoder ---
subgraph ENCGRP["编码器 $q_φ(z|x)$"]
X["训练样本 $x$"]
ENC["神经网络"]
MU["均值 $μ_φ(x)$"]
LOGVAR["对数方差 $log σ_φ²(x)$"]
X --> ENC
ENC --> MU
ENC --> LOGVAR
end
MU -- "重参数化" --> Z(("隐变量 $z$"))
LOGVAR -- "重参数化" --> Z
%% --- Decoder ---
subgraph DECGRP["解码器 $p_θ(x|z)$"]
Z --> DEC["神经网络 $f_θ$"]
DEC --> XHAT["重构 $x̂$"]
end
%% --- Apply styles ---
class X,ENC,MU,LOGVAR,DEC,XHAT node;
class Z soft;
style ENCGRP fill:#E6F0FF,stroke:#60A5FA,stroke-width:2px;
style DECGRP fill:#E6F0FF,stroke:#60A5FA,stroke-width:2px;</div>$$
\text{ELBO}(\theta,\phi;x)
= \mathbb{E}_{q_\phi(z\mid x)}\!\big[\log p_\theta(x\mid z)\big]- \mathrm{KL}\!\big(q_\phi(z\mid x)\,\|\,p(z)\big).
$$<p>最大化 ELBO 等价于最小化其相反数（常作为训练损失）：</p>$$
\min_{\theta,\phi}\;\mathcal{L}(x)= \underbrace{-\,\mathbb{E}_{q_\phi(z\mid x)}\!\big[\log p_\theta(x\mid z)\big]}_{\text{重构损失}}+ \underbrace{\mathrm{KL}\!\big(q_\phi(z\mid x)\,\|\,\mathcal{N}(0,I)\big)}_{\text{先验对齐}}.
$$<p>当采用各向异性高斯后验近似
\(q*\phi(z\mid x)=\mathcal N\!\big(\mu*\phi(x),\mathrm{diag}(\sigma\_\phi^2(x))\big)\)
且先验 \(p(z)=\mathcal N(0,I)\) 时，KL 的闭式解为</p>$$
\mathrm{KL}\!\big(q_\phi(z\mid x)\,\|\,\mathcal N(0,I)\big)
= \frac{1}{2}\sum_{j=1}^{J}\Big(\sigma_j^2+\mu_j^2-\log\sigma_j^2-1\Big),
$$<p>其中 $\mu*j,\sigma_j$ 为 $\mu*\phi(x),\sigma*\phi(x)$ 的分量。实践中常直接预测
$\log\sigma*\phi^2(x)$。</p><h5 class="relative group">训练阶段（learning）<div id=训练阶段learning class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e8%ae%ad%e7%bb%83%e9%98%b6%e6%ae%b5learning aria-label=锚点>#</a></span></h5><ol><li><p>编码器 $q\_{\phi}(z\mid x)$
输入样本 $x$，神经网络输出近似后验参数：</p>$$
\mu_\phi(x),\;\log\sigma_\phi^2(x).
$$<p>由此得到 $\sigma*\phi(x)=\exp\!\big(\tfrac{1}{2}\log\sigma*\phi^2(x)\big)$。</p></li><li><p>重参数化采样（可导）
从标准正态采样 $\epsilon \sim \mathcal N(0, I)$，构造</p>$$
z=\mu_\phi(x)+\sigma_\phi(x)\odot \epsilon,
$$<p>使得梯度可经由 $z$ 传回到 $\phi$。</p></li><li><p>解码器 $p\_{\theta}(x\mid z)$
将 $z$ 输入解码器 $f*\theta$，得到重构 $\hat x=f*\theta(z)$，对应似然 $p*\theta(x\mid z)$。</p></li><li><p>损失函数（最小化）</p>$$
\mathcal L(x) = -\,\mathbb E_{q_\phi(z\mid x)}[\log p_\theta(x\mid z)] + \mathrm{KL}\!\big(q_\phi(z\mid x)\,\|\,\mathcal N(0,I)\big)
$$<ul><li>若建模为伯努利似然 $p\_\theta(x\mid z)=\mathrm{Bernoulli}(\hat x)$（图像已归一化至 $[0,1]$），
重构项对应 BCE。</li><li>若建模为各向同性高斯 $p\_\theta(x\mid z)=\mathcal N(\hat x,\sigma_x^2 I)$（常取固定 $\sigma_x$），
重构项等价于 MSE（差一个常数因子）。</li></ul></li><li><p>优化
对 $(\phi,\theta)$ 进行反向传播与参数更新，直至收敛。</p></li></ol><h5 class="relative group">生成阶段（inference）<div id=生成阶段inference class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%94%9f%e6%88%90%e9%98%b6%e6%ae%b5inference aria-label=锚点>#</a></span></h5><ul><li>直接从先验采样 $z \sim \mathcal N(0,I)$，送入解码器 $f*\theta$ 得到新样本 $\tilde x=f*\theta(z)$。</li></ul><h2 class="relative group">CVAE（Conditional VAE，条件变分自编码器）<div id=cvaeconditional-vae条件变分自编码器 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#cvaeconditional-vae%e6%9d%a1%e4%bb%b6%e5%8f%98%e5%88%86%e8%87%aa%e7%bc%96%e7%a0%81%e5%99%a8 aria-label=锚点>#</a></span></h2><img src=./img/CVAE.png alt=CVAE width=40%><ul><li>条件化思路：引入条件 $c$（如类别、文本特征），并将其注入编码器与解码器：<ul><li>编码器条件化：$\text{Encoder}(x,c)\to(\mu_z,\sigma_z)$，即 $q_\phi(z\mid x,c)$；</li><li>解码器条件化：$\text{Decoder}(z,c)\to \hat x$，即使用 $p_\theta(x\mid z,c)$。</li></ul></li><li>目标函数（条件 ELBO）：
$$
\mathcal L_{\mathrm{CVAE}}(\theta,\phi)
= \mathbb{E}_{q_\phi(z\mid x,c)}\!\left[\log p_\theta(x\mid z,c)\right] - \mathrm{KL}\!\left(q_\phi(z\mid x,c)\,\|\,p(z\mid c)\right)
$$
实践中常取 $p(z\mid c)=\mathcal N(0,I)$（与 $c$ 无关）以简化。</li><li>效果：通过在生成阶段指定 $c$，即可按条件受控生成（例如手写体指定数字“7”）。</li></ul><h3 class="relative group">CVAE 数学推导<div id=cvae-数学推导 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#cvae-%e6%95%b0%e5%ad%a6%e6%8e%a8%e5%af%bc aria-label=锚点>#</a></span></h3><img src=./img/VAE训练流程图.png alt=VAE训练流程图 width=60%>
<img src=./img/CVAE训练流程图.png alt=CVAE训练流程图 width=60%><p>设生成模型为 $p_\theta(x\mid z,c)$，先验为 $p_\theta(z\mid c)$，变分分布为 $q_\phi(z\mid x,c)$。由</p>$$
p(x,z\mid c)=p(z\mid x,c)\,p(x\mid c)
$$<p>可得恒等式</p>$$
\log p(x\mid c)=\log\frac{p(x,z\mid c)}{p(z\mid x,c)}.
$$<p>两边对 $q_\phi(z\mid x,c)$ 积分，左边为</p>$$
\int q_\phi(z\mid x,c)\,\log p(x\mid c)\,\mathrm{d}z=\log p(x\mid c),
$$<p>右边为</p>$$
\int q_\phi(z\mid x,c)\,\log\frac{p(x,z\mid c)}{p(z\mid x,c)}\,\mathrm{d}z.
$$<p>在右侧加并减去同一项 $\int q_\phi(z\mid x,c)\,\log q_\phi(z\mid x,c)\,\mathrm{d}z$，得到</p>$$
\begin{aligned}
\log p(x\mid c)
&=\int q_\phi(z\mid x,c)\,\log\frac{p(x,z\mid c)}{q_\phi(z\mid x,c)}\,\mathrm{d}z
+\int q_\phi(z\mid x,c)\,\log\frac{q_\phi(z\mid x,c)}{p(z\mid x,c)}\,\mathrm{d}z \\
&=\underbrace{\int q_\phi(z\mid x,c)\,\log\frac{p(x,z\mid c)}{q_\phi(z\mid x,c)}\,\mathrm{d}z}_{\text{ELBO}(\theta,\phi;x,c)}
+\underbrace{KL\!\left(q_\phi(z\mid x,c)\,\|\,p(z\mid x,c)\right)}_{\ge 0}.
\end{aligned}
$$<p>由 $KL\ge 0$，得变分下界</p>$$
\log p(x\mid c)\;\ge\;\mathcal{L}_{\text{ELBO}}(\theta,\phi;x,c)
=\int q_\phi(z\mid x,c)\,\log\frac{p(x,z\mid c)}{q_\phi(z\mid x,c)}\,\mathrm{d}z.
$$<p>将联合分布分解为</p>$$
p(x,z\mid c)=p_\theta(x\mid z,c)\,p_\theta(z\mid c),
$$<p>可将下界写成更常见的“重构项 − KL 项”形式：</p>$$
\begin{aligned}
\mathcal{L}_{\text{ELBO}}(\theta,\phi;x,c)
&=\int q_\phi(z\mid x,c)\,\Big[\log p_\theta(x\mid z,c)+\log p_\theta(z\mid c)-\log q_\phi(z\mid x,c)\Big]\,\mathrm{d}z \\
&=\mathbb{E}_{z\sim q_\phi(z\mid x,c)}\!\big[\log p_\theta(x\mid z,c)\big]
-KL\!\left(q_\phi(z\mid x,c)\,\|\,p_\theta(z\mid c)\right).
\end{aligned}
$$<p>其中第一项为“重构项”，第二项为“正则项”（KL）。由于对给定的 $x,c$，$\log p(x\mid c)$ 与变分参数 $\phi$ 无关，因此最大化 $\mathcal{L}_{\text{ELBO}}$ 等价于最小化 $KL\!\left(q_\phi(z\mid x,c)\,\|\,p(z\mid x,c)\right)$；在实践中通过同时优化 $\theta,\phi$ 来最大化该下界。</p><h4 class="relative group">极大似然<div id=极大似然 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e6%9e%81%e5%a4%a7%e4%bc%bc%e7%84%b6 aria-label=锚点>#</a></span></h4><p>对比 VAE 与 CVAE 的目标函数（最大化 ELBO 以近似最大化对数似然）：</p><p>CVAE：</p>$$
\log p_\theta(x\mid c)\;\ge\;
\mathbb{E}_{q_\phi(z\mid x,c)}
\!\big[\underbrace{\log p_\theta(x\mid z,c)}_{\text{重构项 ①}}\big]
\;-\;
\underbrace{\mathrm{KL}\!\left(q_\phi(z\mid x,c)\,\|\,p(z\mid c)\right)}_{\text{正则项 ②}}
$$<p>VAE：</p>$$
\log p_\theta(x)\;\ge\;
\mathbb{E}_{q_\phi(z\mid x)}
\!\big[\underbrace{\log p_\theta(x\mid z)}_{\text{重构项 ①}}\big]
\;-\;
\underbrace{\mathrm{KL}\!\left(q_\phi(z\mid x)\,\|\,p(z)\right)}_{\text{正则项 ②}}
$$<p>说明：</p><ol><li>假设 $q_\phi(z\mid x,c)$ 与 $q_\phi(z\mid x)$ 为高斯分布；在 CVAE 中，推断网络 $q_\phi(z\mid x,c)$ 相比 VAE 额外接收条件 $c$ 作为输入。</li><li>生成分布 $p_\theta(x\mid z,c)$ 与 $p_\theta(x\mid z)$ 常按数据类型选取：连续数据常用高斯，二值数据常用伯努利等；在 CVAE 中，生成网络 $p_\theta(x\mid z,c)$ 同样额外接收条件 $c$。</li><li>CVAE 的先验常写作 $p(z\mid c)$（也可在实践中使用标准正态 $p(z)$ 作为条件无关的简化）。</li></ol><h4 class="relative group">两种理解方式<div id=两种理解方式 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e4%b8%a4%e7%a7%8d%e7%90%86%e8%a7%a3%e6%96%b9%e5%bc%8f aria-label=锚点>#</a></span></h4><p>理解 1：设 $p(z)=\mathcal{N}(0,I)$，并取 $p(z\mid c)=p(z)=\mathcal{N}(0,I)$。</p><p>理解 2：假设 $z$ 与 $c$ 独立，则有 $p(z\mid c)=p(z)$；若再设 $p(z)=\mathcal{N}(0,I)$，则 $p(z\mid c)=\mathcal{N}(0,I)$。</p><h2 class="relative group">结语<div id=结语 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e7%bb%93%e8%af%ad aria-label=锚点>#</a></span></h2><p>至此，我们从 AE 出发，走到能“可采样”的 VAE，再到可“按条件定向生成”的 CVAE：前者解决重构与连续潜在空间，后者让生成受控、更实用。训练中把握好重构—KL 的平衡（如 KL 退火、β-VAE），并将条件 $c$ 同时注入编码器与解码器，往往就能得到稳健的基线。</p><h2 class="relative group"><em>参考资料</em><div id=参考资料 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 aria-label=锚点>#</a></span></h2><div class="expand-wrapper prose dark:prose-invert max-w-prose zen-mode-content"><input id=expand-0 class=expand-toggle type=checkbox>
<label for=expand-0 class=expand-title><span class=expand-icon><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg>
</span>点击展开查看参考资料</label><div class=expand-content><div class=expand-inner><ul><li><a href=https://www.bilibili.com/video/BV1op421S7Ep target=_blank>VAE 变分自编码器原理解析</a></li><li><a href=https://www.bilibili.com/video/BV1X4ebe2Ep4 target=_blank>VAE 问题解答+CVAE 原理解析</a></li><li><a href=https://arxiv.org/abs/1312.6114 target=_blank>VAE 论文地址</a></li><li><a href=https://arxiv.org/abs/1406.5298 target=_blank>CVAE 论文地址</a></li></ul></div></div></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full me-4" width=96 height=96 alt=xiadengma src=/img/author_hu_76f37802f31e48ac.jpg data-zoom-src=/img/author.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">作者</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">xiadengma</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/xiadengma target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://xiadengma.com/ target=_blank aria-label=Link title=Link rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M172.5 131.1c55.6-55.59 148-55.59 203.6.0 50 50 57.4 129.7 16.3 187.2L391.3 319.9C381 334.2 361 337.6 346.7 327.3c-14.4-10.3-17.8-30.3-7.5-44.6L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2c-31.4-31.4-82.5-31.4-114 0L105.5 289.5c-31.51 30.6-31.51 82.5.0 114C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4 265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2c-58.4 41.1-136.3 34.5-186.29-15.4-56.469-56.5-56.469-148.1.0-204.5L172.5 131.1zM467.5 380c-56.5 56.5-148 56.5-204.5.0-50-50-56.5-128.8-15.4-186.3L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7 307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8c31.4 31.4 82.5 31.4 114 0L534.5 222.5c31.5-31.5 31.5-83.4.0-114C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58 374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24c56.5 56.46 56.5 148.06.0 204.46L467.5 380z"/></svg></span></span></a></div></div></div></div><div class=mb-10></div><details class="mt-2 mb-5 overflow-hidden rounded-lg ms-0 ps-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 -ms-5 ps-5 dark:bg-primary-800 dark:text-neutral-100">常见模型深入浅出 -
系列文章</summary><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">§ :
本文</div><div class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><a href=/posts/%E4%B8%80%E4%BA%9B%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/>§ :
一些数学基础概念</a></div></details></div><script>var oid="views_posts/深入浅出VAE和CVAE模型/index.md",oid_likes="likes_posts/深入浅出VAE和CVAE模型/index.md"</script><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/%E4%B8%80%E4%BA%9B%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;一些数学基础概念
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-10-19T01:47:15+08:00>2025年10月19日</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/gnome49-.icns%E6%96%87%E4%BB%B6%E9%A2%84%E8%A7%88%E4%BF%AE%E5%A4%8D/><span class=leading-6>Gnome49 .Icns文件预览修复&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-10-20T17:26:27+08:00>2025年10月20日</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-24 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label=返回顶部 title=返回顶部>&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">© 2025 <a href=https://xiadengma.com target=_blank>XIADENGMA</a> | All rights reserved | <a href=https://beian.miit.gov.cn target=_blank>浙ICP备20005376号-2</a></p><p class="text-xs text-neutral-500 dark:text-neutral-400">🛸 by Hugo & Blowfish</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script src=https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js></script><script>function css(e){return"rgb("+getComputedStyle(document.documentElement).getPropertyValue(e)+")"}mermaid.initialize({startOnLoad:!0,theme:"base",themeVariables:{background:css("--color-neutral"),primaryColor:css("--color-primary-200"),secondaryColor:css("--color-secondary-200"),tertiaryColor:css("--color-neutral-100"),primaryBorderColor:css("--color-primary-400"),secondaryBorderColor:css("--color-secondary-400"),tertiaryBorderColor:css("--color-neutral-400"),lineColor:"#ffffff",fontFamily:"ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,noto sans,sans-serif",fontSize:"16px"}}),document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){const e=document.querySelectorAll(".mermaid svg");e.forEach(e=>{const n=(new XMLSerializer).serializeToString(e),t=document.createElement("img"),s=new Blob([n],{type:"image/svg+xml"}),o=URL.createObjectURL(s);t.src=o,t.style.width="100%",t.style.maxWidth=e.getAttribute("width")||"100%",t.style.height="auto",t.alt="Mermaid diagram",e.parentNode.replaceChild(t,e),mediumZoom(t,{margin:24,background:"rgba(0,0,0,0.8)",scrollOffset:99999})})},1e3)})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://blog.xiadengma.com/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=搜索 tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="关闭 (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>